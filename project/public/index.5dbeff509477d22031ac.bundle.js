/*! For license information please see index.5dbeff509477d22031ac.bundle.js.LICENSE.txt */
var udcomponent;(()=>{var e={56:(e,t,r)=>{"use strict";e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function r(e){for(var r=-1,o=0;o<t.length;o++)if(t[o].identifier===e){r=o;break}return r}function o(e,o){for(var a={},l=[],s=0;s<e.length;s++){var i=e[s],u=o.base?i[0]+o.base:i[0],c=a[u]||0,d="".concat(u," ").concat(c);a[u]=c+1;var p=r(d),f={css:i[1],media:i[2],sourceMap:i[3],supports:i[4],layer:i[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var m=n(f,o);o.byIndex=s,t.splice(s,0,{identifier:d,updater:m,references:1})}l.push(d)}return l}function n(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,n){var a=o(e=e||[],n=n||{});return function(e){e=e||[];for(var l=0;l<a.length;l++){var s=r(a[l]);t[s].references--}for(var i=o(e,n),u=0;u<a.length;u++){var c=r(a[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}a=i}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},160:(e,t,r)=>{"use strict";var o=r(170),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useSyncExternalStore,l=o.useRef,s=o.useEffect,i=o.useMemo,u=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,o,c){var d=l(null);if(null===d.current){var p={hasValue:!1,value:null};d.current=p}else p=d.current;d=i((function(){function e(e){if(!s){if(s=!0,a=e,e=o(e),void 0!==c&&p.hasValue){var t=p.value;if(c(t,e))return l=t}return l=e}if(t=l,n(a,e))return t;var r=o(e);return void 0!==c&&c(t,r)?(a=e,t):(a=e,l=r)}var a,l,s=!1,i=void 0===r?null:r;return[function(){return e(t())},null===i?void 0:function(){return e(i())}]}),[t,r,o,c]);var f=a(e,d[0],d[1]);return s((function(){p.hasValue=!0,p.value=f}),[f]),u(f),f}},170:e=>{"use strict";e.exports=react},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",o=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),o&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),o&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,o,n,a){"string"==typeof e&&(e=[[null,e,void 0]]);var l={};if(o)for(var s=0;s<this.length;s++){var i=this[s][0];null!=i&&(l[i]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);o&&l[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),t.push(c))}},t}},354:e=>{"use strict";e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),a="/*# ".concat(n," */");return[t].concat([a]).join("\n")}return[t].join("\n")}},418:(e,t,r)=>{"use strict";e.exports=r(160)},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},659:e=>{"use strict";var t={};e.exports=function(e,r){var o=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(r)}},748:e=>{window,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function o(e,t){var r,o=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)),o}function n(e){var t,r;for(t=1;t<arguments.length;t++)r=null!=arguments[t]?arguments[t]:{},t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}));return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r,o,n=[],a=!0,l=!1,s=void 0;try{for(r=e[Symbol.iterator]();!(a=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){l=!0,s=e}finally{try{a||null==r.return||r.return()}finally{if(l)throw s}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var r,o;for((null==t||t>e.length)&&(t=e.length),r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}r.r(t),r.d(t,"withComponentFeatures",(function(){return i})),r.d(t,"registerComponent",(function(){return u}));var i=function(e){var t=function(e,t){return new Promise((function(r){UniversalDashboard.post("/api/internal/component/element/".concat(e),t,(function(e){r(e)}))}))},r=function(e,t){return UniversalDashboard.subscribe(e,(function(e,r){var o=r.type;"requestState"===o&&(o="getState"),t(o,r)}))},o=function(e){UniversalDashboard.unsubscribe(e)},a=function(e,t){var r;return r=e,"[object String]"!==Object.prototype.toString.call(r)&&(e.__version||(e.__version="0"),!t&&e.history&&(t=e.history)),UniversalDashboard.renderComponent(e,t)};return function(s){var i=l(react.useState(s),2),u=i[0],c=i[1];react.useEffect((function(){c(s)}),[s.__version]);var d=function(e,t){var r,o;if("setState"===e&&c(n(n({},u),t.state)),"getState"===e&&(r=t.requestId,o=u,new Promise((function(e,t){UniversalDashboard.post("/api/internal/component/element/sessionState/".concat(r),o,(function(r){r.error?t(r.error.message):e(r)}))}))),"addElement"===e){var a=u.children;null==a&&(a=[]),a=a.concat(t.elements),c(n(n({},u),{},{children:a}))}"clearElement"===e&&c(n(n({},u),{},{children:[]})),"removeElement"===e&&c(n(n({},u),{},{hidden:!0})),"syncElement"===e&&c(n(n({},u),{},{__version:Math.random().toString(36).substr(2,5)}))};react.useEffect((function(){var e=r(s.id,d);return function(){o(e)}}));var p={render:a,setState:function(e){var t=n(n({},u),e);c(t)},publish:UniversalDashboard.publish,notifyOfEvent:function(e,t){UniversalDashboard.publish("element-event",{type:"clientEvent",eventId:s.id+e,eventName:e,eventData:t})},post:t,subscribeToIncomingEvents:r,unsubscribeFromIncomingEvents:o};return Object.keys(u).forEach((function(e){null!=u[e]&&u[e].endpoint&&(p[e]=function(t){var r={};return u[e].accept&&""!==u[e].accept&&(r.Accept=u[e].accept),u[e].contentType&&""!==u[e].contentType&&(r["Content-Type"]=u[e].contentType),function(e,t,r){return new Promise((function(o){UniversalDashboard.postWithHeaders("/api/internal/component/element/".concat(e),t,(function(e){o(e)}),r)}))}(u[e].name,t,r)})})),u.hidden?react.createElement(react.Fragment):e(n(n({},u),p))}},u=function(e,t){UniversalDashboard.register(e,t)}}])},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var o="";r.supports&&(o+="@supports (".concat(r.supports,") {")),r.media&&(o+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(o+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),o+=r.css,n&&(o+="}"),r.media&&(o+="}"),r.supports&&(o+="}");var a=r.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},992:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var o=r(354),n=r.n(o),a=r(314),l=r.n(a)()(n());l.push([e.id,'.ruleGroup{display:flex;flex-direction:column;gap:.5rem;padding:.5rem;border-width:1px}.ruleGroup .ruleGroup-body{display:flex;flex-direction:column;gap:.5rem}.ruleGroup .ruleGroup-body:empty{display:none}.ruleGroup .ruleGroup-header,.ruleGroup .rule{display:flex;gap:.5rem;align-items:center}.ruleGroup .rule .rule-value:has(.rule-value-list-item){display:flex;gap:.5rem;align-items:baseline}.ruleGroup .betweenRules{display:flex}.ruleGroup .shiftActions{display:flex;flex-direction:column}.ruleGroup .shiftActions>*{padding:0}.dndOver.rule,.dndOver.ruleGroup-header{padding-bottom:.5rem}.dndOver.betweenRules{padding-top:.5rem}.queryBuilder-branches .ruleGroup-body{margin-left:calc(2*0.5rem)}.queryBuilder-branches .rule,.queryBuilder-branches .ruleGroup .ruleGroup{position:relative}.queryBuilder-branches .rule::before,.queryBuilder-branches .rule::after,.queryBuilder-branches .ruleGroup .ruleGroup::before,.queryBuilder-branches .ruleGroup .ruleGroup::after{content:"";width:.5rem;left:calc(-0.5rem - 1px);border-radius:0;position:absolute}.queryBuilder-branches .rule::before,.queryBuilder-branches .ruleGroup .ruleGroup::before{top:-0.5rem;height:calc(50% + 0.5rem);border-width:0 0 1px 1px}.queryBuilder-branches .rule::after,.queryBuilder-branches .ruleGroup .ruleGroup::after{top:50%;height:50%;border-width:0 0 0 1px}.queryBuilder-branches .rule:last-child::after,.queryBuilder-branches .ruleGroup .ruleGroup:last-child::after{display:none}.queryBuilder-branches .ruleGroup .ruleGroup::before,.queryBuilder-branches .ruleGroup .ruleGroup::after{left:calc(-0.5rem - 1px - 1px)}.queryBuilder-branches .ruleGroup .ruleGroup::before{top:calc(-0.5rem - 1px);height:calc(50% + 0.5rem + 1px)}.queryBuilder-branches .ruleGroup .ruleGroup::after{height:calc(50% + 1px)}.queryBuilder-branches .betweenRules{position:relative}.queryBuilder-branches .betweenRules::before{content:"";width:.5rem;left:calc(-0.5rem - 1px);border-radius:0;position:absolute;top:-0.5rem;height:calc(100% + 0.5rem);border-width:0 0 0 1px}.ruleGroup{border-color:#8081a2;border-style:solid;border-radius:.25rem;background:rgba(0,75,183,.2)}.ruleGroup .shiftActions>*{background-color:rgba(0,0,0,0);border:none;cursor:pointer}.dndOver.rule,.dndOver.ruleGroup-header{border-bottom-width:2px;border-bottom-style:dashed;border-bottom-color:#639}.dndOver.rule.dndCopy,.dndOver.ruleGroup-header.dndCopy{border-bottom-color:#693}.dndOver.betweenRules{border-top-width:2px;border-top-style:dashed;border-top-color:#639}.dndOver.betweenRules.dndCopy{border-top-color:#693}.ruleGroup.dndDragging,.rule.dndDragging{opacity:.5}.ruleGroup .queryBuilder-dragHandle,.rule .queryBuilder-dragHandle{cursor:move}.queryBuilder-branches .rule::before,.queryBuilder-branches .rule::after,.queryBuilder-branches .ruleGroup .ruleGroup::before,.queryBuilder-branches .ruleGroup .ruleGroup::after{border-color:#8081a2;border-style:solid}.queryBuilder-branches .rule:last-child::before,.queryBuilder-branches .ruleGroup .ruleGroup:last-child::before{border-bottom-left-radius:.25rem}.queryBuilder-branches .betweenRules{position:relative}.queryBuilder-branches .betweenRules::before{border-color:#8081a2;border-style:solid}/*# sourceMappingURL=query-builder.css.map */\n',"",{version:3,sources:["webpack://./node_modules/react-querybuilder/dist/query-builder-layout.scss","webpack://./node_modules/react-querybuilder/dist/query-builder.scss"],names:[],mappings:"AAqBA,WACE,YAAA,CACA,qBAAA,CACA,SAbY,CAcZ,aAdY,CAeZ,gBAdiB,CAgBjB,2BACE,YAAA,CACA,qBAAA,CACA,SApBU,CAsBV,iCACE,YAAA,CAIJ,8CAEE,YAAA,CACA,SA9BU,CA+BV,kBAAA,CAIA,wDACE,YAAA,CACA,SArCQ,CAsCR,oBAAA,CAIJ,yBACE,YAAA,CAGF,yBACE,YAAA,CACA,qBAAA,CAEA,2BACE,SAAA,CAQJ,wCAEE,oBA7DU,CA+DZ,sBACE,iBAhEU,CAuEZ,uCACE,0BAAA,CAGF,0EAEE,iBAAA,CAEA,kLAEE,UAAA,CACA,WAlFQ,CAmFR,wBAAA,CACA,eAAA,CACA,iBAAA,CAGF,0FACE,WAAA,CACA,yBAAA,CACA,wBAAA,CAGF,wFACE,OAAA,CACA,UAAA,CACA,sBAAA,CAGF,8GACE,YAAA,CAKF,yGAEE,8BAAA,CAGF,qDACE,uBAAA,CACA,+BAAA,CAGF,oDACE,sBAAA,CAIJ,qCACE,iBAAA,CAEA,6CACE,UAAA,CACA,WA9HQ,CA+HR,wBAAA,CACA,eAAA,CACA,iBAAA,CACA,WAAA,CACA,0BAAA,CACA,sBAAA,CCrDN,WACE,oBAjCiB,CAkCjB,kBAjCiB,CAkCjB,oBAjCkB,CAkClB,4BArCqB,CAwCnB,2BACE,8BAAA,CACA,WAAA,CACA,cAAA,CAQJ,wCAEE,uBAAA,CAMA,0BAAA,CAMA,wBAAA,CAOA,wDACE,wBAAA,CASJ,sBACE,oBAAA,CAMA,uBAAA,CAMA,qBAAA,CAOA,8BACE,qBAAA,CAaJ,yCACE,UAAA,CAGF,mEACE,WAAA,CASA,kLAEE,oBAnIa,CAoIb,kBAnIa,CAsIf,gHACE,gCAtIc,CA0IlB,qCACE,iBAAA,CAEA,6CACE,oBAhJa,CAiJb,kBAhJa,CAAA,4CAAA",sourceRoot:""}]);const s=l}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={id:o,exports:{}};return e[o](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nc=void 0,(()=>{"use strict";var e=r(170),t=r.n(e),o=r(748),n=r(418);var a={notify(){},get:()=>[]};var l=(()=>!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement))(),s=(()=>"undefined"!=typeof navigator&&"ReactNative"===navigator.product)(),i=(()=>l||s?e.useLayoutEffect:e.useEffect)();Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var u=Symbol.for("react-redux-context"),c="undefined"!=typeof globalThis?globalThis:{};function d(){if(!e.createContext)return{};const t=c[u]??=new Map;let r=t.get(e.createContext);return r||(r=e.createContext(null),t.set(e.createContext,r)),r}var p=d(),f=function(t){const{children:r,context:o,serverState:n,store:l}=t,s=e.useMemo((()=>{const e=function(e,t){let r,o=a,n=0,l=!1;function s(){c.onStateChange&&c.onStateChange()}function i(){n++,r||(r=t?t.addNestedSub(s):e.subscribe(s),o=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){(()=>{let t=e;for(;t;)t.callback(),t=t.next})()},get(){const t=[];let r=e;for(;r;)t.push(r),r=r.next;return t},subscribe(r){let o=!0;const n=t={callback:r,next:null,prev:t};return n.prev?n.prev.next=n:e=n,function(){o&&null!==e&&(o=!1,n.next?n.next.prev=n.prev:t=n.prev,n.prev?n.prev.next=n.next:e=n.next)}}}}())}function u(){n--,r&&0===n&&(r(),r=void 0,o.clear(),o=a)}const c={addNestedSub:function(e){i();const t=o.subscribe(e);let r=!1;return()=>{r||(r=!0,t(),u())}},notifyNestedSubs:function(){o.notify()},handleChangeWrapper:s,isSubscribed:function(){return l},trySubscribe:function(){l||(l=!0,i())},tryUnsubscribe:function(){l&&(l=!1,u())},getListeners:()=>o};return c}(l);return{store:l,subscription:e,getServerState:n?()=>n:void 0}}),[l,n]),u=e.useMemo((()=>l.getState()),[l]);i((()=>{const{subscription:e}=s;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),u!==l.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}}),[s,u]);const c=o||p;return e.createElement(c.Provider,{value:s},r)};function m(t=p){return function(){return e.useContext(t)}}var h=m();function b(e=p){const t=e===p?h:m(e),r=()=>{const{store:e}=t();return e};return Object.assign(r,{withTypes:()=>r}),r}var g=b();var v=(e,t)=>e===t;function y(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var A=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),C=()=>Math.random().toString(36).substring(7).split("").join("."),$={INIT:`@@redux/INIT${C()}`,REPLACE:`@@redux/REPLACE${C()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${C()}`};function w(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function N(e,t,r){if("function"!=typeof e)throw new Error(y(2));if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error(y(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error(y(1));return r(N)(e,t)}let o=e,n=t,a=new Map,l=a,s=0,i=!1;function u(){l===a&&(l=new Map,a.forEach(((e,t)=>{l.set(t,e)})))}function c(){if(i)throw new Error(y(3));return n}function d(e){if("function"!=typeof e)throw new Error(y(4));if(i)throw new Error(y(5));let t=!0;u();const r=s++;return l.set(r,e),function(){if(t){if(i)throw new Error(y(6));t=!1,u(),l.delete(r),a=null}}}function p(e){if(!w(e))throw new Error(y(7));if(void 0===e.type)throw new Error(y(8));if("string"!=typeof e.type)throw new Error(y(17));if(i)throw new Error(y(9));try{i=!0,n=o(n,e)}finally{i=!1}return(a=l).forEach((e=>{e()})),e}return p({type:$.INIT}),{dispatch:p,subscribe:d,getState:c,replaceReducer:function(e){if("function"!=typeof e)throw new Error(y(10));o=e,p({type:$.REPLACE})},[A]:function(){const e=d;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error(y(11));function r(){const e=t;e.next&&e.next(c())}return r(),{unsubscribe:e(r)}},[A](){return this}}}}}function S(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...r)=>e(t(...r))))}function G(e){return({dispatch:t,getState:r})=>o=>n=>"function"==typeof n?n(t,r,e):o(n)}var R=G(),E=G,D=Symbol.for("immer-nothing"),O=Symbol.for("immer-draftable"),k=Symbol.for("immer-state");function I(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var _=Object.getPrototypeOf;function x(e){return!!e&&!!e[k]}function q(e){return!!e&&(B(e)||Array.isArray(e)||!!e[O]||!!e.constructor?.[O]||L(e)||U(e))}var M=Object.prototype.constructor.toString();function B(e){if(!e||"object"!=typeof e)return!1;const t=_(e);if(null===t)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===M}function j(e,t){0===T(e)?Reflect.ownKeys(e).forEach((r=>{t(r,e[r],e)})):e.forEach(((r,o)=>t(o,r,e)))}function T(e){const t=e[k];return t?t.type_:Array.isArray(e)?1:L(e)?2:U(e)?3:0}function P(e,t){return 2===T(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function W(e,t,r){const o=T(e);2===o?e.set(t,r):3===o?e.add(r):e[t]=r}function L(e){return e instanceof Map}function U(e){return e instanceof Set}function F(e){return e.copy_||e.base_}function V(e,t){if(L(e))return new Map(e);if(U(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=B(e);if(!0===t||"class_only"===t&&!r){const t=Object.getOwnPropertyDescriptors(e);delete t[k];let r=Reflect.ownKeys(t);for(let o=0;o<r.length;o++){const n=r[o],a=t[n];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[n]})}return Object.create(_(e),t)}{const t=_(e);if(null!==t&&r)return{...e};const o=Object.create(t);return Object.assign(o,e)}}function Q(e,t=!1){return z(e)||x(e)||!q(e)||(T(e)>1&&(e.set=e.add=e.clear=e.delete=H),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>Q(t,!0)))),e}function H(){I(2)}function z(e){return Object.isFrozen(e)}var X,K={};function J(e){const t=K[e];return t||I(0),t}function Y(){return X}function Z(e,t){t&&(J("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ee(e){te(e),e.drafts_.forEach(oe),e.drafts_=null}function te(e){e===X&&(X=e.parent_)}function re(e){return X={drafts_:[],parent_:X,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function oe(e){const t=e[k];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function ne(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return void 0!==e&&e!==r?(r[k].modified_&&(ee(t),I(4)),q(e)&&(e=ae(t,e),t.parent_||se(t,e)),t.patches_&&J("Patches").generateReplacementPatches_(r[k].base_,e,t.patches_,t.inversePatches_)):e=ae(t,r,[]),ee(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==D?e:void 0}function ae(e,t,r){if(z(t))return t;const o=t[k];if(!o)return j(t,((n,a)=>le(e,o,t,n,a,r))),t;if(o.scope_!==e)return t;if(!o.modified_)return se(e,o.base_,!0),o.base_;if(!o.finalized_){o.finalized_=!0,o.scope_.unfinalizedDrafts_--;const t=o.copy_;let n=t,a=!1;3===o.type_&&(n=new Set(t),t.clear(),a=!0),j(n,((n,l)=>le(e,o,t,n,l,r,a))),se(e,t,!1),r&&e.patches_&&J("Patches").generatePatches_(o,r,e.patches_,e.inversePatches_)}return o.copy_}function le(e,t,r,o,n,a,l){if(x(n)){const l=ae(e,n,a&&t&&3!==t.type_&&!P(t.assigned_,o)?a.concat(o):void 0);if(W(r,o,l),!x(l))return;e.canAutoFreeze_=!1}else l&&r.add(n);if(q(n)&&!z(n)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;ae(e,n),t&&t.scope_.parent_||"symbol"==typeof o||!Object.prototype.propertyIsEnumerable.call(r,o)||se(e,n)}}function se(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Q(t,r)}var ie={get(e,t){if(t===k)return e;const r=F(e);if(!P(r,t))return function(e,t,r){const o=de(t,r);return o?"value"in o?o.value:o.get?.call(e.draft_):void 0}(e,r,t);const o=r[t];return e.finalized_||!q(o)?o:o===ce(e.base_,t)?(fe(e),e.copy_[t]=me(o,e)):o},has:(e,t)=>t in F(e),ownKeys:e=>Reflect.ownKeys(F(e)),set(e,t,r){const o=de(F(e),t);if(o?.set)return o.set.call(e.draft_,r),!0;if(!e.modified_){const o=ce(F(e),t),l=o?.[k];if(l&&l.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(((n=r)===(a=o)?0!==n||1/n==1/a:n!=n&&a!=a)&&(void 0!==r||P(e.base_,t)))return!0;fe(e),pe(e)}var n,a;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==ce(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,fe(e),pe(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=F(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:o.enumerable,value:r[t]}:o},defineProperty(){I(11)},getPrototypeOf:e=>_(e.base_),setPrototypeOf(){I(12)}},ue={};function ce(e,t){const r=e[k];return(r?F(r):e)[t]}function de(e,t){if(!(t in e))return;let r=_(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=_(r)}}function pe(e){e.modified_||(e.modified_=!0,e.parent_&&pe(e.parent_))}function fe(e){e.copy_||(e.copy_=V(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function me(e,t){const r=L(e)?J("MapSet").proxyMap_(e,t):U(e)?J("MapSet").proxySet_(e,t):function(e,t){const r=Array.isArray(e),o={type_:r?1:0,scope_:t?t.scope_:Y(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=o,a=ie;r&&(n=[o],a=ue);const{revoke:l,proxy:s}=Proxy.revocable(n,a);return o.draft_=s,o.revoke_=l,s}(e,t);return(t?t.scope_:Y()).drafts_.push(r),r}function he(e){if(!q(e)||z(e))return e;const t=e[k];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=V(e,t.scope_.immer_.useStrictShallowCopy_)}else r=V(e,!0);return j(r,((e,t)=>{W(r,e,he(t))})),t&&(t.finalized_=!1),r}j(ie,((e,t)=>{ue[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ue.deleteProperty=function(e,t){return ue.set.call(this,e,t,void 0)},ue.set=function(e,t,r){return ie.set.call(this,e[0],t,r,e[0])};var be=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if("function"==typeof e&&"function"!=typeof t){const r=t;t=e;const o=this;return function(e=r,...n){return o.produce(e,(e=>t.call(this,e,...n)))}}let o;if("function"!=typeof t&&I(6),void 0!==r&&"function"!=typeof r&&I(7),q(e)){const n=re(this),a=me(e,void 0);let l=!0;try{o=t(a),l=!1}finally{l?ee(n):te(n)}return Z(n,r),ne(o,n)}if(!e||"object"!=typeof e){if(o=t(e),void 0===o&&(o=e),o===D&&(o=void 0),this.autoFreeze_&&Q(o,!0),r){const t=[],n=[];J("Patches").generateReplacementPatches_(e,o,t,n),r(t,n)}return o}I(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...r)=>this.produceWithPatches(t,(t=>e(t,...r)));let r,o;return[this.produce(e,t,((e,t)=>{r=e,o=t})),r,o]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;q(e)||I(8),x(e)&&(x(t=e)||I(10),e=he(t));const r=re(this),o=me(e,void 0);return o[k].isManual_=!0,te(r),o}finishDraft(e,t){const r=e&&e[k];r&&r.isManual_||I(9);const{scope_:o}=r;return Z(o,t),ne(void 0,o)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const o=t[r];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}r>-1&&(t=t.slice(r+1));const o=J("Patches").applyPatches_;return x(e)?o(e,t):this.produce(e,(e=>o(e,t)))}},ge=be.produce;be.produceWithPatches.bind(be),be.setAutoFreeze.bind(be),be.setUseStrictShallowCopy.bind(be),be.applyPatches.bind(be),be.createDraft.bind(be),be.finishDraft.bind(be);var ve="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?S:S.apply(null,arguments)};function ye(e,t){function r(...r){if(t){let o=t(...r);if(!o)throw new Error(Ie(0));return{type:e,payload:o.payload,..."meta"in o&&{meta:o.meta},..."error"in o&&{error:o.error}}}return{type:e,payload:r[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=t=>function(e){return w(e)&&"type"in e&&"string"==typeof e.type}(t)&&t.type===e,r}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var Ae=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function Ce(e){return q(e)?ge(e,(()=>{})):e}function $e(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}var we=e=>t=>{setTimeout(t,e)};function Ne(e){const t={},r=[];let o;const n={addCase(e,r){const o="string"==typeof e?e:e.type;if(!o)throw new Error(Ie(28));if(o in t)throw new Error(Ie(29));return t[o]=r,n},addMatcher:(e,t)=>(r.push({matcher:e,reducer:t}),n),addDefaultCase:e=>(o=e,n)};return e(n),[t,r,o]}var Se=Symbol.for("rtk-slice-createasyncthunk");function Ge(e,t){return`${e}/${t}`}function Re({creators:e}={}){const t=e?.asyncThunk?.[Se];return function(e){const{name:r,reducerPath:o=r}=e;if(!r)throw new Error(Ie(11));const n=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},a=Object.keys(n),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},s={addCase(e,t){const r="string"==typeof e?e:e.type;if(!r)throw new Error(Ie(12));if(r in l.sliceCaseReducersByType)throw new Error(Ie(13));return l.sliceCaseReducersByType[r]=t,s},addMatcher:(e,t)=>(l.sliceMatchers.push({matcher:e,reducer:t}),s),exposeAction:(e,t)=>(l.actionCreators[e]=t,s),exposeCaseReducer:(e,t)=>(l.sliceCaseReducersByName[e]=t,s)};function i(){const[t={},r=[],o]="function"==typeof e.extraReducers?Ne(e.extraReducers):[e.extraReducers],n={...t,...l.sliceCaseReducersByType};return function(e){let t,[a,s,i]=Ne((e=>{for(let t in n)e.addCase(t,n[t]);for(let t of l.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of r)e.addMatcher(t.matcher,t.reducer);o&&e.addDefaultCase(o)}));if("function"==typeof e)t=()=>Ce(e());else{const r=Ce(e);t=()=>r}function u(e=t(),r){let o=[a[r.type],...s.filter((({matcher:e})=>e(r))).map((({reducer:e})=>e))];return 0===o.filter((e=>!!e)).length&&(o=[i]),o.reduce(((e,t)=>{if(t){if(x(e)){const o=t(e,r);return void 0===o?e:o}if(q(e))return ge(e,(e=>t(e,r)));{const o=t(e,r);if(void 0===o){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return o}}return e}),e)}return u.getInitialState=t,u}(e.initialState)}a.forEach((o=>{const a=n[o],l={reducerName:o,type:Ge(r,o),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(a)?function({type:e,reducerName:t,createNotation:r},o,n){let a,l;if("reducer"in o){if(r&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(o))throw new Error(Ie(17));a=o.reducer,l=o.prepare}else a=o;n.addCase(e,a).exposeCaseReducer(t,a).exposeAction(t,l?ye(e,l):ye(e))}(l,a,s):function({type:e,reducerName:t},r,o,n){if(!n)throw new Error(Ie(18));const{payloadCreator:a,fulfilled:l,pending:s,rejected:i,settled:u,options:c}=r,d=n(e,a,c);o.exposeAction(t,d),l&&o.addCase(d.fulfilled,l),s&&o.addCase(d.pending,s),i&&o.addCase(d.rejected,i),u&&o.addMatcher(d.settled,u),o.exposeCaseReducer(t,{fulfilled:l||Oe,pending:s||Oe,rejected:i||Oe,settled:u||Oe})}(l,a,s,t)}));const u=e=>e,c=new Map,d=new WeakMap;let p;function f(e,t){return p||(p=i()),p(e,t)}function m(){return p||(p=i()),p.getInitialState()}function h(t,r=!1){function o(e){let n=e[t];return void 0===n&&r&&(n=$e(d,o,m)),n}function n(t=u){const o=$e(c,r,(()=>new WeakMap));return $e(o,t,(()=>{const o={};for(const[n,a]of Object.entries(e.selectors??{}))o[n]=Ee(a,t,(()=>$e(d,t,m)),r);return o}))}return{reducerPath:t,getSelectors:n,get selectors(){return n(o)},selectSlice:o}}const b={name:r,reducer:f,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:m,...h(o),injectInto(e,{reducerPath:t,...r}={}){const n=t??o;return e.inject({reducerPath:n,reducer:f},r),{...b,...h(n,!0)}}};return b}}function Ee(e,t,r,o){function n(n,...a){let l=t(n);return void 0===l&&o&&(l=r()),e(l,...a)}return n.unwrapped=e,n}var De=Re();function Oe(){}var{assign:ke}=Object;function Ie(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Symbol.for("rtk-state-proxy-original");var _e={"¬º":"1/4","¬Ω":"1/2","¬æ":"3/4","‚Öê":"1/7","‚Öë":"1/9","‚Öí":"1/10","‚Öì":"1/3","‚Öî":"2/3","‚Öï":"1/5","‚Öñ":"2/5","‚Öó":"3/5","‚Öò":"4/5","‚Öô":"1/6","‚Öö":"5/6","‚Öõ":"1/8","‚Öú":"3/8","‚Öù":"5/8","‚Öû":"7/8","‚Öü":"1/"},xe=/^(?=-?\s*\.\d|-?\s*\d)(-)?\s*((?:\d(?:[\d,_]*\d)?)*)(([eE][+-]?\d(?:[\d,_]*\d)?)?|\.\d(?:[\d,_]*\d)?([eE][+-]?\d(?:[\d,_]*\d)?)?|(\s+\d(?:[\d,_]*\d)?\s*)?\s*\/\s*\d(?:[\d,_]*\d)?)?$/,qe=new RegExp(xe.source.replace(/\$$/,"(?:\\s*[^\\.\\d\\/].*)?")),Me=new RegExp(`(${Object.keys(_e).join("|")})`),Be={MMM:3e3,MM:2e3,M:1e3,CM:900,DCCC:800,DCC:700,DC:600,D:500,CD:400,CCC:300,CC:200,C:100,XC:90,LXXX:80,LXX:70,LX:60,L:50,XL:40,XXX:30,XX:20,XII:12,XI:11,X:10,IX:9,VIII:8,VII:7,VI:6,V:5,IV:4,III:3,II:2,I:1},je={‚Ö†:"I",‚Ö°:"II",‚Ö¢:"III",‚Ö£:"IV",‚Ö§:"V",‚Ö•:"VI",‚Ö¶:"VII",‚Öß:"VIII",‚Ö®:"IX",‚Ö©:"X",‚Ö™:"XI",‚Ö´:"XII",‚Ö¨:"L",‚Ö≠:"C",‚ÖÆ:"D",‚ÖØ:"M",‚Ö∞:"I",‚Ö±:"II",‚Ö≤:"III",‚Ö≥:"IV",‚Ö¥:"V",‚Öµ:"VI",‚Ö∂:"VII",‚Ö∑:"VIII",‚Ö∏:"IX",‚Öπ:"X",‚Ö∫:"XI",‚Öª:"XII",‚Öº:"L",‚ÖΩ:"C",‚Öæ:"D",‚Öø:"M"},Te=new RegExp(`(${Object.keys(je).join("|")})`,"gi"),Pe=/^(?=[MDCLXVI])(M{0,3})(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$/i,We={round:3,allowTrailingInvalid:!1,romanNumerals:!1},Le=/^\s*\//,Ue=(0,e.createContext)({}),Fe=t=>e.createElement("button",{type:"button","data-testid":t.testID,disabled:t.disabled&&!t.disabledTranslation,className:t.className,title:t.disabledTranslation&&t.disabled?t.disabledTranslation.title:t.title,onClick:e=>t.handleOnClick(e)},t.disabledTranslation&&t.disabled?t.disabledTranslation.label:t.label),Ve=(0,e.forwardRef)(((t,r)=>e.createElement("span",{"data-testid":t.testID,ref:r,className:t.className,title:t.title},t.label))),Qe="------",He={fields:{title:"Fields",placeholderName:"~",placeholderLabel:Qe,placeholderGroupLabel:Qe},operators:{title:"Operators",placeholderName:"~",placeholderLabel:Qe,placeholderGroupLabel:Qe},value:{title:"Value"},removeRule:{label:"‚®Ø",title:"Remove rule"},removeGroup:{label:"‚®Ø",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"‚ßâ",title:"Clone rule"},cloneRuleGroup:{label:"‚ßâ",title:"Clone group"},shiftActionUp:{label:"ÀÑ",title:"Shift up"},shiftActionDown:{label:"ÀÖ",title:"Shift down"},dragHandle:{label:"‚Åû‚Åû",title:"Drag handle"},lockRule:{label:"üîì",title:"Lock rule"},lockGroup:{label:"üîì",title:"Lock group"},lockRuleDisabled:{label:"üîí",title:"Unlock rule"},lockGroupDisabled:{label:"üîí",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},ze=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],Xe=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}],Ke="queryBuilder-valid",Je="queryBuilder-invalid",Ye="shiftActions",Ze="dndDragging",et="dndOver",tt="dndCopy",rt="queryBuilder-dragHandle",ot="queryBuilder-disabled",nt="rule-value-list-item",at={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:"",betweenRules:"",valid:"",invalid:"",dndDragging:"",dndOver:"",dndCopy:"",disabled:"",valueListItem:"",branches:""},lt="rule",st="rule-group",it="inline-combinator",ut="add-group",ct="remove-group",dt="clone-group",pt="add-rule",ft="combinators",mt="not-toggle",ht="shift-actions",bt="drag-handle",gt="lock-group",vt="action aborted: parent path disabled",yt="action aborted: path is disabled",At="rule or group added";function Ct(e){let t,r,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e)){const n=e.length;for(t=0;t<n;t++)e[t]&&(r=Ct(e[t]))&&(o&&(o+=" "),o+=r)}else for(r in e)e[r]&&(o&&(o+=" "),o+=r);return o}function $t(...e){let t,r,o=0,n="";const a=e.length;for(;o<a;o++)(t=e[o])&&(r=Ct(t))&&(n&&(n+=" "),n+=r);return n}var wt=$t,Nt=De({name:"queries",initialState:{},reducers:{setQueryState:(e,{payload:{qbId:t,query:r}})=>{e[t]=r}},selectors:{getQuerySelectorById:(e,t)=>e[t]}}),St="QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",Gt="QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",Rt="A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",Et="A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",Dt="QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ot="QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",kt="QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",It="QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd.",_t=De({name:"warnings",initialState:{[St]:!1,[Gt]:!1,[Rt]:!1,[Et]:!1,[Dt]:!1,[Ot]:!1,[kt]:!1,[It]:!1},reducers:{rqbWarn:(e,{payload:t})=>{e[t]||(console.error(t),e[t]=!0)}}}),xt={queries:Nt.getInitialState(),warnings:_t.getInitialState()},qt=function(e){const t=function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:o=!0,actionCreatorCheck:n=!0}=e??{};let a=new Ae;return t&&("boolean"==typeof t?a.push(R):a.push(E(t.extraArgument))),a},{reducer:r,middleware:o,devTools:n=!0,duplicateMiddlewareCheck:a=!0,preloadedState:l,enhancers:s}=e||{};let i,u;if("function"==typeof r)i=r;else{if(!w(r))throw new Error(Ie(1));i=function(e){const t=Object.keys(e),r={};for(let o=0;o<t.length;o++){const n=t[o];"function"==typeof e[n]&&(r[n]=e[n])}const o=Object.keys(r);let n;try{!function(e){Object.keys(e).forEach((t=>{const r=e[t];if(void 0===r(void 0,{type:$.INIT}))throw new Error(y(12));if(void 0===r(void 0,{type:$.PROBE_UNKNOWN_ACTION()}))throw new Error(y(13))}))}(r)}catch(e){n=e}return function(e={},t){if(n)throw n;let a=!1;const l={};for(let n=0;n<o.length;n++){const s=o[n],i=r[s],u=e[s],c=i(u,t);if(void 0===c)throw t&&t.type,new Error(y(14));l[s]=c,a=a||c!==u}return a=a||o.length!==Object.keys(e).length,a?l:e}}(r)}u="function"==typeof o?o(t):t();let c=S;n&&(c=ve({trace:!1,..."object"==typeof n&&n}));const d=function(...e){return t=>(r,o)=>{const n=t(r,o);let a=()=>{throw new Error(y(15))};const l={getState:n.getState,dispatch:(e,...t)=>a(e,...t)},s=e.map((e=>e(l)));return a=S(...s)(n.dispatch),{...n,dispatch:a}}}(...u),p=(e=>function(t){const{autoBatch:r=!0}=t??{};let o=new Ae(e);return r&&o.push(((e={type:"raf"})=>t=>(...r)=>{const o=t(...r);let n=!0,a=!1,l=!1;const s=new Set,i="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:we(10):"callback"===e.type?e.queueNotification:we(e.timeout),u=()=>{l=!1,a&&(a=!1,s.forEach((e=>e())))};return Object.assign({},o,{subscribe(e){const t=o.subscribe((()=>n&&e()));return s.add(e),()=>{t(),s.delete(e)}},dispatch(e){try{return n=!e?.meta?.RTK_autoBatch,a=!n,a&&(l||(l=!0,i(u))),o.dispatch(e)}finally{n=!0}}})})("object"==typeof r?r:void 0)),o})(d);return N(i,l,c(..."function"==typeof s?s(p):p()))}({reducer:{queries:Nt.reducer,warnings:_t.reducer},preloadedState:xt,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),Mt=e.createContext(null),Bt=function(t=p){const r=t===p?h:m(t),o=(t,o={})=>{const{equalityFn:a=v}="function"==typeof o?{equalityFn:o}:o,l=r(),{store:s,subscription:i,getServerState:u}=l,c=(e.useRef(!0),e.useCallback({[t.name]:e=>t(e)}[t.name],[t])),d=(0,n.useSyncExternalStoreWithSelector)(i.addNestedSub,s.getState,u||s.getState,c,a);return e.useDebugValue(d),d};return Object.assign(o,{withTypes:()=>o}),o}(Mt),jt=e=>t=>Nt.selectors.getQuerySelectorById({queries:t.queries},e),Tt=({payload:e,onQueryChange:t})=>r=>{r(Nt.actions.setQueryState(e)),"function"==typeof t&&t(e.query)},Pt=function(e=p){const t=e===p?g:b(e),r=()=>t().dispatch;return Object.assign(r,{withTypes:()=>r}),r}(Mt),Wt=b(Mt),{rqbWarn:Lt}=_t.actions;function Ut(e,t,r){Pt()}var Ft=(e,t=",")=>"string"==typeof e?e.split(`\\${t}`).map((e=>e.split(t))).reduce(((e,r,o)=>0===o?r:[...e.slice(0,-1),`${e.at(-1)}${t}${r[0]}`,...r.slice(1)]),[]):[],Vt=(e,t=",")=>e.map((e=>`${e??""}`.replaceAll(t[0],`\\${t[0]}`))).join(t),Qt=e=>"string"==typeof e?e.trim():e,Ht=(e,{retainEmptyStrings:t}={})=>Array.isArray(e)?e.map((e=>Qt(e))):"string"==typeof e?Ft(e,",").filter(t?()=>!0:e=>!/^\s*$/.test(e)).map((e=>e.trim())):"number"==typeof e?[e]:[],zt=new RegExp(xe.source.replace(/^\^/,String.raw`^\s*`).replace(/\$$/,String.raw`\s*$`)),Xt=e=>null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype,Kt=e=>Xt(e)&&Array.isArray(e.rules),Jt=e=>Kt(e)&&"string"==typeof e.combinator,Yt=e=>Kt(e)&&void 0===e.combinator,Zt=e=>Kt(e)?er(e):e,er=e=>{const t=[],r=e=>t.push(Zt(e));let o=0;for(let n=0;n<e.rules.length;n+=2)if(1===e.rules.length)r(e.rules[0]);else if("and"===e.rules[n+1]){o=n;let r=1;for(;"and"===e.rules[o+r];)n+=2,r+=2;t.push({rules:e.rules.slice(o,n+1).map((e=>Zt(e)))}),n-=2}else"or"===e.rules[n+1]&&(0===n||n===e.rules.length-3?(0!==n&&"or"!==e.rules[n-1]||r(e.rules[n]),r(e.rules[n+1]),n===e.rules.length-3&&r(e.rules[n+2])):("and"===e.rules[n-1]||r(e.rules[n]),r(e.rules[n+1])));return 1===t.length&&"object"==typeof t[0]&&Kt(t[0])?{...e,...t[0]}:{...e,rules:t}},tr=e=>{if(Jt(e))return e;const t=er(e),r=t.rules.map((e=>"string"!=typeof e&&Kt(e)?tr(e):e)),o=r.length<2?"and":r[1],n=r.filter((e=>"string"!=typeof e));return{...t,combinator:o,rules:n}},rr=e=>Xt(e)&&"name"in e&&"string"==typeof e.name,or=e=>Xt(e)&&"value"in e&&"string"==typeof e.value;function nr(e,t){return ge((e=>{const r={};let o=!!t;if(rr(e)&&!or(e)?(r.value=e.name,o=!0):!rr(e)&&or(e)&&(r.name=e.value,o=!0),o)return Object.assign({},t,e,r)}))(e)}function ar(e,t){return Array.isArray(e)?ge((e=>{if(ur(e))for(const r of e)for(const[e,o]of r.options.entries())r.options[e]=nr(o,t);else for(const[r,o]of e.entries())e[r]=nr(o,t)}))(e):[]}function lr(e,t){return Object.fromEntries(Object.entries(e).map((([e,r])=>[e,nr(r,t)])))}var sr=e=>{const t=new Set,r=[];for(const o of e)t.has(o.value??o.name)||(t.add(o.value??o.name),r.push(o));return e.length===r.length?e:r},ir=e=>Array.isArray(e)&&e.length>0&&Xt(e[0])&&"options"in e[0]&&Array.isArray(e[0].options),ur=e=>{if(Array.isArray(e))for(const t of e)if(Xt(t)&&"options"in t)for(const e of t.options)return!(!Xt(e)||!("name"in e)&&!("value"in e));return!1},cr=(e,t)=>(ir(e)?e.flatMap((e=>e.options)):e).find((e=>e.value===t||e.name===t)),dr=e=>{if(!Array.isArray(e)||0===e.length)return null;if(ur(e)){for(const t of e)if(t.options.length>0)return t.options[0].value??t.options[0].name;return null}return e[0].value??e[0].name},pr=e=>{const t=new Set,r=new Set,o=[];for(const n of e)if(!t.has(n.label)){t.add(n.label);const e=[];for(const t of n.options)r.has(t.value??t.name)||(r.add(t.value??t.name),e.push(nr(t)));o.push({...n,options:e})}return o},fr=(e,t,r)=>{const o=nr(e),n=nr(r);return o.value!==n.value&&("string"==typeof o.comparator?o[o.comparator]===n[o.comparator]:o.comparator?.(n,t)??!1)},mr=(e,t,r)=>{if(!e.comparator){const r=t=>(t.value??t.name)!==(e.value??e.name);return ur(t)?t.map((e=>({...e,options:e.options.filter((e=>r(e)))}))):t.filter((e=>r(e)))}return ur(t)?t.map((t=>({...t,options:t.options.filter((t=>fr(e,r,t)))}))).filter((e=>e.options.length>0)):t.filter((t=>fr(e,r,t)))},hr=(e,{parseNumbers:t}={})=>{if(!t||"bigint"==typeof e||"number"==typeof e)return e;if("native"===t)return parseFloat(e);const r=((e,t=We)=>{if("number"==typeof e||"bigint"==typeof e)return e;let r=NaN;const o=`${e}`.replace(Me,((e,t)=>` ${_e[t]}`)).replace("‚ÅÑ","/").trim();if(0===o.length)return NaN;const n={...We,...t},a=(n.allowTrailingInvalid?qe:xe).exec(o);if(!a)return n.romanNumerals?(e=>{const t=`${e}`.replace(Te,((e,t)=>je[t])).toUpperCase(),r=Pe.exec(t);if(!r)return NaN;const[,o,n,a,l]=r;return(Be[o]??0)+(Be[n]??0)+(Be[a]??0)+(Be[l]??0)})(o):NaN;const[,l,s,i]=a,u=s.replace(/[,_]/g,""),c=null==i?void 0:i.replace(/[,_]/g,"");if(r=!u&&c&&c.startsWith(".")?0:parseInt(u),!c)return l?-1*r:r;const d=!1===n.round?NaN:parseFloat(`1e${Math.floor(Math.max(0,n.round))}`);if(c.startsWith(".")||c.startsWith("e")||c.startsWith("E")){const e=parseFloat(`${r}${c}`);r=isNaN(d)?e:Math.round(e*d)/d}else if(Le.test(c)){const e=parseInt(u),t=parseInt(c.replace("/",""));r=isNaN(d)?e/t:Math.round(e*d/t)/d}else{const e=c.split("/"),[t,o]=e.map((e=>parseInt(e)));r+=isNaN(d)?t/o:Math.round(t*d/o)/d}return l?-1*r:r})(e,{allowTrailingInvalid:"enhanced"===t,romanNumerals:!1,round:!1});return isNaN(r)?e:r},br=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},gr={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},vr={and:"&&",or:"||"},yr=e=>({...e,rules:e.rules.map((e=>{if("string"==typeof e)return e;if(Kt(e))return yr(e);if(Array.isArray(e.value))return{...e,value:e.value.map((e=>hr(e,{parseNumbers:!0})))};const t=Ht(e.value,{retainEmptyStrings:!0}).map((e=>hr(e,{parseNumbers:!0})));if(t.every((e=>"number"==typeof e))){if(t.length>1)return{...e,value:t};if(1===t.length)return{...e,value:t[0]}}return e}))}),Ar=e=>"string"==typeof e&&e.length>0||"number"==typeof e&&!isNaN(e)||"string"!=typeof e&&"number"!=typeof e,Cr=(e,t)=>!!t&&("number"==typeof e||"bigint"==typeof e||"string"==typeof e&&zt.test(e)),$r=(e=["",""])=>Array.isArray(e)?e:"string"==typeof e?[e,e]:e??["",""],wr=(e,{quoteFieldNamesWith:t,fieldIdentifierSeparator:r})=>{const[o,n]=$r(t);return"string"==typeof r&&r.length>0?Vt(Ft(e,r).map((e=>`${o}${e}${n}`)),r):`${o}${e}${n}`},Nr=e=>null==e||""===e,Sr=e=>/^(does)?not/i.test(e),Gr=(e,t)=>"string"==typeof e&&t?e.replaceAll('"','\\"'):e,Rr=({field:e,operator:t,value:r,valueSource:o},{escapeQuotes:n,parseNumbers:a}={})=>{const l="field"===o,s=t.replace(/^=$/,"=="),i="number"==typeof r||"boolean"==typeof r||"bigint"==typeof r||Cr(r,a);switch(s){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${s} ${l||i?Qt(r):`"${Gr(r,n)}"`}`;case"contains":case"doesNotContain":return`${Sr(s)?"!":""}${e}.contains(${l?Qt(r):`"${Gr(r,n)}"`})`;case"beginsWith":case"doesNotBeginWith":return`${Sr(s)?"!":""}${e}.startsWith(${l?Qt(r):`"${Gr(r,n)}"`})`;case"endsWith":case"doesNotEndWith":return`${Sr(s)?"!":""}${e}.endsWith(${l?Qt(r):`"${Gr(r,n)}"`})`;case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{const t=Sr(s);return`${t?"!(":""}${e} in [${Ht(r).map((e=>l||Cr(e,a)?`${Qt(e)}`:`"${Gr(e,n)}"`)).join(", ")}]${t?")":""}`}case"between":case"notBetween":{const o=Ht(r);if(o.length>=2&&!Nr(o[0])&&!Nr(o[1])){const[r,a]=o,s=Cr(r,!0)?hr(r,{parseNumbers:!0}):NaN,i=Cr(a,!0)?hr(a,{parseNumbers:!0}):NaN;let u=isNaN(s)?l?`${r}`:`"${Gr(r,n)}"`:s,c=isNaN(i)?l?`${a}`:`"${Gr(a,n)}"`:i;return u===s&&c===i&&i<s&&(c=s,u=i),"between"===t?`(${e} >= ${u} && ${e} <= ${c})`:`(${e} < ${u} || ${e} > ${c})`}return""}}return""},Er=JSON.stringify,Dr=({field:e,operator:t,value:r,valueSource:o},{parseNumbers:n}={})=>{const a="field"===o;if("="===t&&!a)return Er({[e]:Cr(r,n)?hr(r,{parseNumbers:"strict"}):r});switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{const o=gr[t];return Er(a?{$expr:{[o]:[`$${e}`,`$${r}`]}}:{[e]:{[o]:Cr(r,n)?hr(r,{parseNumbers:"strict"}):r}})}case"contains":return Er(a?{$where:`this.${e}.includes(this.${r})`}:{[e]:{$regex:r}});case"beginsWith":return Er(a?{$where:`this.${e}.startsWith(this.${r})`}:{[e]:{$regex:`^${r}`}});case"endsWith":return Er(a?{$where:`this.${e}.endsWith(this.${r})`}:{[e]:{$regex:`${r}$`}});case"doesNotContain":return Er(a?{$where:`!this.${e}.includes(this.${r})`}:{[e]:{$not:{$regex:r}}});case"doesNotBeginWith":return Er(a?{$where:`!this.${e}.startsWith(this.${r})`}:{[e]:{$not:{$regex:`^${r}`}}});case"doesNotEndWith":return Er(a?{$where:`!this.${e}.endsWith(this.${r})`}:{[e]:{$not:{$regex:`${r}$`}}});case"null":return Er({[e]:null});case"notNull":return Er({[e]:{$ne:null}});case"in":case"notIn":{const o=Ht(r);return Er(a?{$where:`${"notIn"===t?"!":""}[${o.map((e=>`this.${e}`)).join(",")}].includes(this.${e})`}:{[e]:{[gr[t]]:o.map((e=>Cr(e,n)?hr(e,{parseNumbers:"strict"}):e))}})}case"between":case"notBetween":{const o=Ht(r);if(o.length>=2&&Ar(o[0])&&Ar(o[1])){const[r,n]=o,l=Cr(r,!0)?hr(r,{parseNumbers:"strict"}):NaN,s=Cr(n,!0)?hr(n,{parseNumbers:"strict"}):NaN,i=a||isNaN(l)?r:l,u=a||isNaN(s)?n:s;return Er("between"===t?a?{$and:[{$expr:{$gte:[`$${e}`,`$${i}`]}},{$expr:{$lte:[`$${e}`,`$${u}`]}}]}:{[e]:{$gte:i,$lte:u}}:a?{$or:[{$expr:{$lt:[`$${e}`,`$${i}`]}},{$expr:{$gt:[`$${e}`,`$${u}`]}}]}:{$or:[{[e]:{$lt:i}},{[e]:{$gt:u}}]})}return""}}return""},Or=e=>/^(does)?not/i.test(e),kr=(e,t)=>t?`!(${e})`:`${e}`,Ir=(e,t)=>"string"==typeof e&&t?e.replaceAll("'","\\'"):e,_r=({field:e,operator:t,value:r,valueSource:o},{escapeQuotes:n,parseNumbers:a}={})=>{const l="field"===o,s=t.replace(/^=$/,"=="),i="number"==typeof r||"boolean"==typeof r||"bigint"==typeof r||Cr(r,a);switch(s){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${s} ${l||i?Qt(r):`'${Ir(r,n)}'`}`;case"contains":case"doesNotContain":return kr(`${e} matches ${l||i?Qt(r):`'${Ir(r,n)}'`}`,Or(s));case"beginsWith":case"doesNotBeginWith":{const t=l?`'^'.concat(${Qt(r)})`:`'${"string"==typeof r&&!r.startsWith("^")||i?"^":""}${Ir(r,n)}'`;return kr(`${e} matches ${t}`,Or(s))}case"endsWith":case"doesNotEndWith":{const t=l?`${Qt(r)}.concat('$')`:`'${Ir(r,n)}${"string"==typeof r&&!r.endsWith("$")||i?"$":""}'`;return kr(`${e} matches ${t}`,Or(s))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{const t=Or(s)?"!":"",o=Ht(r);return o.length>0?`${t}(${o.map((t=>`${e} == ${l||Cr(t,a)?`${Qt(t)}`:`'${Ir(t,n)}'`}`)).join(" or ")})`:""}case"between":case"notBetween":{const o=Ht(r);if(o.length>=2&&!Nr(o[0])&&!Nr(o[1])){const[r,a]=o,s=Cr(r,!0)?hr(r,{parseNumbers:!0}):NaN,i=Cr(a,!0)?hr(a,{parseNumbers:!0}):NaN;let u=isNaN(s)?l?`${r}`:`'${Ir(r,n)}'`:s,c=isNaN(i)?l?`${a}`:`'${Ir(a,n)}'`:i;return u===s&&c===i&&i<s&&(c=s,u=i),"between"===t?`(${e} >= ${u} and ${e} <= ${c})`:`(${e} < ${u} or ${e} > ${c})`}return""}}return""},xr=({operator:e,value:t,valueSource:r},{escapeQuotes:o,parseNumbers:n,quoteFieldNamesWith:a,quoteValuesWith:l,concatOperator:s="||",fieldIdentifierSeparator:i}={})=>{const u="field"===r,c=e.toLowerCase(),d=l||"'",p=e=>`${d}${e}${d}`,f=e=>((e,t,r)=>r&&"string"==typeof e?e.replaceAll(`${t}`,`${t}${t}`):e)(e,d,o),m=e=>p(f(e)),h=e=>wr(e,{quoteFieldNamesWith:a,fieldIdentifierSeparator:i}),b=(...e)=>"CONCAT"===s.toUpperCase()?`CONCAT(${e.join(", ")})`:e.join(` ${s} `);switch(c){case"null":case"notnull":return"";case"in":case"notin":{const e=Ht(t);return e.length>0?`(${e.map((e=>u?h(e):Cr(e,n)?`${Qt(e)}`:`${m(e)}`)).join(", ")})`:""}case"between":case"notbetween":{const e=Ht(t,{retainEmptyStrings:!0});if(e.length>=2&&Ar(e[0])&&Ar(e[1])){const[t,r]=e,o=Cr(t,n)?hr(t,{parseNumbers:"strict"}):NaN,a=Cr(r,n)?hr(r,{parseNumbers:"strict"}):NaN,l=isNaN(o)?u?`${t}`:t:o,s=isNaN(a)?u?`${r}`:r:a,i=[l,s];return l===o&&s===a&&a<o&&(i[0]=a,i[1]=o),(u?i.map((e=>h(e))):i.every((e=>Cr(e,n)))?i.map((e=>hr(e,{parseNumbers:"strict"}))):i.map((e=>m(e)))).join(" and ")}return""}case"contains":case"doesnotcontain":return u?b(p("%"),h(t),p("%")):p(`%${f(t)}%`);case"beginswith":case"doesnotbeginwith":return u?b(h(t),p("%")):p(`${f(t)}%`);case"endswith":case"doesnotendwith":return u?b(p("%"),h(t)):p(`%${f(t)}`)}return"boolean"==typeof t?t?"TRUE":"FALSE":u?h(t):Cr(t,n)?`${Qt(t)}`:`${m(t)}`},qr={"<":"lt","<=":"lte",">":"gt",">=":"gte"},Mr=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,Br=e=>e?.replace(/('|\\)/g,"\\$1"),jr={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},Tr=(e,t)=>"boolean"==typeof e?e:Cr(e,t)?hr(e,{parseNumbers:t}):e,Pr=({field:e,operator:t,value:r,valueSource:o},{parseNumbers:n}={})=>{if("field"===o){if(Ht(r).some((e=>"string"!=typeof e)))return!1;const o=Br(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{const e="="===t?"==":t,n=Br(r);return!!n&&{bool:{filter:{script:{script:`doc['${o}'] ${e} doc['${n}']`}}}}}case"in":case"notIn":{const e=Ht(r);if(e.length>0){const r=e.map((e=>({bool:{filter:{script:{script:`doc['${o}'] == doc['${e}']`}}}})));return{bool:"in"===t?{should:r}:{must_not:r}}}return!1}case"between":case"notBetween":{const e=Ht(r);if(e.length>=2&&e[0]&&e[1]){const r=`doc['${o}'] >= doc['${e[0]}'] && doc['${o}'] <= doc['${e[1]}']`;return{bool:{filter:{script:{script:"notBetween"===t?`!(${r})`:r}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{const e=Br(r);return!!e&&{bool:{filter:{script:{script:((e,t,r)=>{const o=`doc['${e}'].${jr[t]??t}(doc['${r}'])`;return t.startsWith("d")?`!${o}`:o})(o,t,e)}}}}}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[qr[t]]:Tr(r,n)}}};case"=":return{term:{[e]:Tr(r,n)}};case"!=":return{bool:{must_not:{term:{[e]:Tr(r,n)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{const o=Ht(r).map((e=>Tr(e,n)));if(o.length>0){const r=o.map((t=>({term:{[e]:Tr(t,n)}})));return{bool:"in"===t?{should:r}:{must_not:r}}}return!1}case"between":case"notBetween":{const o=Ht(r);if(o.length>=2&&Ar(o[0])&&Ar(o[1])){let[r,n]=o;if(Cr(r,!0)&&Cr(n,!0)){const e=hr(r,{parseNumbers:!0}),t=hr(n,{parseNumbers:!0});t<e?(n=e,r=t):(r=e,n=t)}return Mr(t,{range:{[e]:{gte:r,lte:n}}})}return!1}case"contains":case"doesNotContain":return Mr(t,{regexp:{[e]:{value:`.*${r}.*`}}});case"beginsWith":case"doesNotBeginWith":return Mr(t,{regexp:{[e]:{value:`${r}.*`}}});case"endsWith":case"doesNotEndWith":return Mr(t,{regexp:{[e]:{value:`.*${r}`}}})}return!1},Wr=e=>/^(does)?not/i.test(e),Lr=(e,t)=>`"${"string"==typeof e&&t?e.replaceAll('"','\\"'):e}"`,Ur=(e,t)=>t?`$not(${e})`:`${e}`,Fr=e=>`${e}`.replaceAll(/[$()*+.?[\\\]^{|}]/g,String.raw`\$&`).replaceAll("-",String.raw`\x2d`),Vr=({field:e,operator:t,value:r,valueSource:o},{escapeQuotes:n,parseNumbers:a=!0,quoteFieldNamesWith:l=["",""],fieldIdentifierSeparator:s=""}={})=>{const i="field"===o,u="number"==typeof r||"boolean"==typeof r||"bigint"==typeof r||Cr(r,a),c=e=>wr(e,{quoteFieldNamesWith:l,fieldIdentifierSeparator:s});switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return`${c(e)} ${t} ${i?c(Qt(r)):u?Qt(r):Lr(r,n)}`;case"contains":case"doesNotContain":return Ur(`$contains(${c(e)}, ${i?c(Qt(r)):Lr(r,n)})`,Wr(t));case"beginsWith":case"doesNotBeginWith":return Ur(i?`$substring(${c(e)}, 0, $length(${c(Qt(r))})) = ${c(Qt(r))}`:`$contains(${c(e)}, /^${Fr(r)}/)`,Wr(t));case"endsWith":case"doesNotEndWith":return Ur(i?`$substring(${c(e)}, $length(${c(e)}) - $length(${c(Qt(r))})) = ${c(Qt(r))}`:`$contains(${c(e)}, /${Fr(r)}$/)`,Wr(t));case"null":return`${c(e)} = null`;case"notNull":return`${c(e)} != null`;case"in":case"notIn":{const o=Ht(r);return Ur(`${c(e)} in [${o.map((e=>i?`${c(Qt(e))}`:Cr(e,a)?`${Qt(e)}`:Lr(e,n))).join(", ")}]`,Wr(t))}case"between":case"notBetween":{const o=Ht(r);if(o.length>=2&&!Nr(o[0])&&!Nr(o[1])){const[r,l]=o,s=Cr(r,!0)?hr(r,{parseNumbers:!0}):NaN,u=Cr(l,!0)?hr(l,{parseNumbers:!0}):NaN;let d=isNaN(s)?i?`${r}`:r:s,p=isNaN(u)?i?`${l}`:l:u;d===s&&p===u&&u<s&&(p=s,d=u);const f=Cr(r,a)&&Cr(l,a),m=`${c(e)} >= ${i?c(r):f?d:Lr(d,n)} and ${c(e)} <= ${i?c(l):f?p:Lr(p,n)}`;return"between"===t?`(${m})`:Ur(m,!0)}return""}}return""},Qr=e=>e.replace(/^(=)$/,"$1=").replace(/^notnull$/i,"!=").replace(/^null$/i,"=="),Hr=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,zr=({field:e,operator:t,value:r,valueSource:o},{parseNumbers:n}={})=>{const a="field"===o,l={var:e},s=e=>a?{var:`${e}`}:Cr(e,n)?hr(e,{parseNumbers:n}):e;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[Qr(t)]:[l,s(r)]};case"null":case"notNull":return{[("notNull"===t?"!":"=")+"="]:[l,null]};case"in":case"notIn":{const e=Ht(r).map((e=>s(e)));return Hr(t,{in:[l,e]})}case"between":case"notBetween":{const e=Ht(r);if(e.length>=2&&Ar(e[0])&&Ar(e[1])){let[r,o]=e;if(!a&&Cr(r,!0)&&Cr(o,!0)){const e=hr(r,{parseNumbers:!0}),t=hr(o,{parseNumbers:!0});t<e?(o=e,r=t):(r=e,o=t)}else a&&(r={var:r},o={var:o});return Hr(t,{"<=":[r,l,o]})}return!1}case"contains":case"doesNotContain":{const e={in:[s(r),l]};return Hr(t,e)}case"beginsWith":case"doesNotBeginWith":{const e={startsWith:[l,s(r)]};return Hr(t,e)}case"endsWith":case"doesNotEndWith":{const e={endsWith:[l,s(r)]};return Hr(t,e)}}return!1},Xr=(e,t,r)=>{const{fieldData:o,format:n,getNextNamedParam:a,parseNumbers:l,paramPrefix:s,paramsKeepPrefix:i,numberedParams:u,quoteFieldNamesWith:c=["",""],concatOperator:d,valueProcessor:p=xr}=t??{},{processedParams:f=[]}=r??{},m="parameterized"===n,h=[],b={},g=e=>m?{sql:e,params:h}:{sql:e,params:b},v=p(e,{parseNumbers:l,quoteFieldNamesWith:c,concatOperator:d,fieldData:o,format:n}),y=br(e.operator),A=y.toLowerCase(),[C,$]=c;if(!("in"!==A&&"not in"!==A&&"between"!==A&&"not between"!==A||v))return g("");if("is null"===A||"is not null"===A)return g(`${C}${e.field}${$} ${y}`);if("field"===e.valueSource)return g(`${C}${e.field}${$} ${y} ${v}`.trim());if("in"===A||"not in"===A){const t=Ht(e.value);if(m){for(const e of t)h.push(Cr(e,l)?hr(e,{parseNumbers:l}):e);return g(`${C}${e.field}${$} ${y} (${t.map(((e,r)=>u?`${s}${f.length+1+t.length-(t.length-r)}`:"?")).join(", ")})`)}const r=[];for(const o of t){const t=a(e.field);r.push(`${s}${t}`),b[`${i?s:""}${t}`]=Cr(o,l)?hr(o,{parseNumbers:l}):o}return g(`${C}${e.field}${$} ${y} (${r.join(", ")})`)}if("between"===A||"not between"===A){const t=Ht(e.value,{retainEmptyStrings:!0}),[r,o]=t.slice(0,2).map((e=>Cr(e,l)?hr(e,{parseNumbers:l}):e));if(m)return h.push(r,o),g(`${C}${e.field}${$} ${y} ${u?`${s}${f.length+1}`:"?"} and ${u?`${s}${f.length+2}`:"?"}`);const n=a(e.field),c=a(e.field);return b[`${i?s:""}${n}`]=r,b[`${i?s:""}${c}`]=o,g(`${C}${e.field}${$} ${y} ${s}${n} and ${s}${c}`)}let w=e.value;"string"==typeof e.value&&(w=Cr(e.value,l)?hr(e.value,{parseNumbers:l}):/^'.*'$/g.test(v)?v.replaceAll(/(^'|'$)/g,""):v);let N="";return m?h.push(w):(N=a(e.field),b[`${i?s:""}${N}`]=w),g(`${C}${e.field}${$} ${y} ${m?u?`${s}${f.length+1}`:"?":`${s}${N}`}`.trim())},Kr=e=>Xt(e)&&"boolean"==typeof e.valid,Jr=(e,t,r)=>{if("boolean"==typeof t)return t;if(Kr(t))return t.valid;if("function"==typeof r&&!Kt(e)){const t=r(e);if("boolean"==typeof t)return t;if(Kr(t))return t.valid}return!0},Yr=(e,t={})=>{const{escapeQuotes:r,fields:o,parseNumbers:n,quoteFieldNamesWith:a,quoteValuesWith:l,fieldIdentifierSeparator:s}=t,i="field"===e.valueSource,u=e.operator.toLowerCase(),c=l||"'",d=e=>(e=>`${c}${e}${c}`)((e=>((e,t,r)=>r&&"string"==typeof e?e.replaceAll(`${t}`,`${t}${t}`):e)(e,c,r))(e)),p=e=>wr(e,{quoteFieldNamesWith:a,fieldIdentifierSeparator:s});switch(u){case"null":case"notnull":return"";case"between":case"notbetween":return xr(e,t);case"in":case"notin":{const t=Ht(e.value);if(0===t.length)return"";const r=t.map((t=>i?p(cr(o??[],e.value)?.label??t):Cr(t,n)?`${Qt(t)}`:`${d(t)}`));return r.length<=2?r.join(" or "):`${r.slice(0,-1).join(", ")}, or ${r.at(-1)}`}}return"boolean"==typeof e.value?e.value?"true":"false":i?p(cr(o??[],e.value)?.label??e.value):Cr(e.value,n)?`${Qt(e.value)}`:`${d(e.value)}`},Zr=(e,t)=>{const{fields:r,fieldData:o,parseNumbers:n,escapeQuotes:a,quoteFieldNamesWith:l=["",""],fieldIdentifierSeparator:s="",quoteValuesWith:i="'",valueProcessor:u=Yr,concatOperator:c="||",getOperators:d=()=>[]}=t??{},p=u(e,{fields:r,parseNumbers:n,escapeQuotes:a,quoteFieldNamesWith:l,fieldIdentifierSeparator:s,quoteValuesWith:i,concatOperator:c}),f=e.operator.toLowerCase();return"in"!==f&&"notin"!==f&&"between"!==f&&"notbetween"!==f||p?`${wr(o?.label??e.field,{quoteFieldNamesWith:l,fieldIdentifierSeparator:s})} ${((e,t="value")=>{switch(e.value.toLowerCase()){case"=":return"field"===t?"is the same as the value in":"is";case"!=":return"field"===t?"is not the same as the value in":"is not";case"<":return"field"===t?"is less than the value in":"is less than";case">":return"field"===t?"is greater than the value in":"is greater than";case"<=":return"field"===t?"is less than or equal to the value in":"is less than or equal to";case">=":return"field"===t?"is greater than or equal to the value in":"is greater than or equal to";case"contains":return"field"===t?"contains the value in":"contains";case"beginswith":return"field"===t?"starts with the value in":"starts with";case"endswith":return"field"===t?"ends with the value in":"ends with";case"doesnotcontain":return"field"===t?"does not contain the value in":"does not contain";case"doesnotbeginwith":return"field"===t?"does not start with the value in":"does not start with";case"doesnotendwith":return"field"===t?"does not end with the value in":"does not end with";case"null":return"is null";case"notnull":return"is not null";case"in":return"field"===t?"is the same as a value in":"is one of the values";case"notin":return"field"===t?"is not the same as any value in":"is not one of the values";case"between":return"field"===t?"is between the values in":"is between";case"notbetween":return"field"===t?"is not between the values in":"is not between";default:return e.label}})(cr(ar(d(e.field,{fieldData:o??{name:e.field,value:e.field,label:e.field}})??[]),e.operator)??{name:e.operator,value:e.operator,label:e.operator},e.valueSource)} ${p}`.trim():""},eo={ansi:{},sqlite:{paramsKeepPrefix:!0},oracle:{},mssql:{concatOperator:"+",quoteFieldNamesWith:["[","]"],fieldIdentifierSeparator:"."},mysql:{concatOperator:"CONCAT"},postgresql:{quoteFieldNamesWith:'"',numberedParams:!0,paramPrefix:"$"}};function to(e,t={}){let r="json",o=xr,n=null,a=["",""],l="",s=()=>!0,i=[],u=()=>[],c={},d="",p=":",f=!1,m=!1,h=!1,b="~",g="~",v="'",y="||";if("string"==typeof t)switch(r=t.toLowerCase(),r){case"natural_language":n=Zr;break;case"mongodb":n=Dr;break;case"parameterized":case"parameterized_named":n=Xr;break;case"cel":n=Rr;break;case"spel":n=_r;break;case"jsonlogic":n=zr;break;case"elasticsearch":n=Pr;break;case"jsonata":n=Vr}else{const e={...eo[t.preset??"ansi"]??null,...t};r=(e.format??"json").toLowerCase();const{valueProcessor:c=null,ruleProcessor:A=null}=e;"function"==typeof A&&(n=A),o="function"==typeof c?(e,t)=>(e=>e.length>=3)(c)?c(e.field,e.operator,e.value,e.valueSource):c(e,t):"natural_language"===r?Yr:"mongodb"===r?n??Dr:"cel"===r?n??Rr:"spel"===r?n??_r:"jsonlogic"===r?n??zr:"elasticsearch"===r?n??Pr:"jsonata"===r?n??Vr:xr,a=$r(e.quoteFieldNamesWith),l=e.fieldIdentifierSeparator??"",s=e.validator??(()=>!0),i=ar(e.fields??[]),u=(t,r)=>ar(e.getOperators?.(t,r)??[]),d=e.fallbackExpression??"",p=e.paramPrefix??":",f=!!e.paramsKeepPrefix,m=!!e.numberedParams,h=!!e.parseNumbers,b=e.placeholderFieldName??"~",g=e.placeholderOperatorName??"~",v=e.quoteValuesWith??"'",y=e.concatOperator??"||"}if(d||(d="mongodb"===r?'"$and":[{"$expr":true}]':"cel"===r||"spel"===r?"1 == 1":"natural_language"===r?"1 is 1":"(1 = 1)"),"json"===r||"json_without_ids"===r){const t=h?ge(e,yr):e;return"json_without_ids"===r?JSON.stringify(t,((e,t)=>"id"===e||"path"===e?void 0:t)):JSON.stringify(t,null,2)}if("function"==typeof s){const t=s(e);if("boolean"==typeof t){if(!1===t)return"parameterized"===r?{sql:d,params:[]}:"parameterized_named"===r?{sql:d,params:{}}:"mongodb"===r?`{${d}}`:"jsonlogic"!==r&&("elasticsearch"===r?{}:d)}else c=t}const A={},C=sr(ir($=i)?$.flatMap((e=>e.options)):$);var $;for(const e of C)"function"==typeof e.validator&&(A[e.value??e.name]=e.validator);const w=e=>{let t,r;if(e.id&&(t=c[e.id]),C.length>0){const t=C.filter((t=>t.name===e.field));if(t.length>0){const e=t[0];"function"==typeof e.validator&&(r=e.validator)}}return[t,r]};if("sql"===r){const t=(e,s)=>{if(!Jr(e,c[e.id??""]))return s?d:"";const u=e.rules.map((s=>{if("string"==typeof s)return s;if(Kt(s))return t(s,1===e.rules.length);const[u,c]=w(s);if(!Jr(s,u,c)||s.field===b||s.operator===g)return"";const d="value"===(s.valueSource??"value"),p=cr(i,s.field);return"function"==typeof n?n(s,{parseNumbers:h,escapeQuotes:d,quoteFieldNamesWith:a,fieldIdentifierSeparator:l,fieldData:p,format:r,quoteValuesWith:v,concatOperator:y}):((e,t)=>{const{parseNumbers:r,escapeQuotes:o,quoteFieldNamesWith:n=["",""],fieldIdentifierSeparator:a="",quoteValuesWith:l="'",valueProcessor:s=xr,concatOperator:i="||"}=t??{},u=s(e,{parseNumbers:r,escapeQuotes:o,quoteFieldNamesWith:n,fieldIdentifierSeparator:a,quoteValuesWith:l,concatOperator:i}),c=br(e.operator),d=c.toLowerCase();return"in"!==d&&"not in"!==d&&"between"!==d&&"not between"!==d||u?`${wr(e.field,{quoteFieldNamesWith:n,fieldIdentifierSeparator:a})} ${c} ${u}`.trim():""})(s,{parseNumbers:h,escapeQuotes:d,valueProcessor:o,quoteFieldNamesWith:a,fieldIdentifierSeparator:l,fieldData:p,format:r,quoteValuesWith:v,concatOperator:y})}));return 0===u.length?d:`${e.not?"NOT ":""}(${u.filter(Boolean).join(Jt(e)?` ${e.combinator} `:" ")})`};return t(e,!0)}if("parameterized"===r||"parameterized_named"===r){const t="parameterized"===r,u=[],v={},A=new Map,C=e=>{A.has(e)||A.set(e,new Set);const t=`${e}_${A.get(e).size+1}`;return A.get(e).add(t),t},$=e=>{const[t,c]=w(e);if(!Jr(e,t,c)||e.field===b||e.operator===g)return"";const $=cr(i,e.field),N=Object.fromEntries([...A.entries()].map((([e,t])=>[e,[...t]]))),S=("function"==typeof n?n:Xr)(e,{getNextNamedParam:C,fieldParamNames:N,parseNumbers:h,quoteFieldNamesWith:a,concatOperator:y,fieldIdentifierSeparator:l,fieldData:$,format:r,paramPrefix:p,paramsKeepPrefix:f,numberedParams:m,fallbackExpression:d,valueProcessor:o,fields:i,placeholderFieldName:b,placeholderOperatorName:g,validator:s},{processedParams:u});if(!Xt(S))return"";const{sql:G,params:R}=S;if("string"!=typeof G||!G)return"";if("parameterized"===r&&Array.isArray(R))u.push(...R);else if("parameterized_named"===r&&Xt(R)){Object.assign(v,R);for(const t of Object.keys(R))A.get(e.field)?.add(t)}return G},N=(e,t)=>{if(!Jr(e,c[e.id??""]))return t?d:"";const r=e.rules.map((t=>"string"==typeof t?t:Kt(t)?N(t,1===e.rules.length):$(t)));return 0===r.length?d:`${e.not?"NOT ":""}(${r.filter(Boolean).join(Jt(e)?` ${e.combinator} `:" ")})`};return t?{sql:N(e,!0),params:u}:{sql:N(e,!0),params:v}}if("mongodb"===r){const t=(e,a)=>{if(!Jr(e,c[e.id??""]))return a?d:"";const l=`"$${e.combinator.toLowerCase()}"`;let s=!1;const u=e.rules.map((e=>{if(Kt(e)){const r=t(e);return r?(s=!0,/^{.+}$/.test(r)?r:`{${r}}`):""}const[a,l]=w(e);if(!Jr(e,a,l)||e.field===b||e.operator===g)return"";const u=cr(i,e.field);return(n??o)(e,{parseNumbers:h,fieldData:u,format:r})})).filter(Boolean);return u.length>0?1!==u.length||s?`${l}:[${u.join(",")}]`:u[0]:d},a=Jt(e)?e:tr(e),l=t(a,!0);return/^{.+}$/.test(l)?l:`{${l}}`}if("cel"===r){const t=(e,a)=>{if(!Jr(e,c[e.id??""]))return a?d:"";const l=e.rules.map((e=>{if("string"==typeof e)return vr[e];if(Kt(e))return t(e);const[a,l]=w(e);if(!Jr(e,a,l)||e.field===b||e.operator===g)return"";const s=cr(i,e.field);return(n??o)(e,{parseNumbers:h,escapeQuotes:"value"===(e.valueSource??"value"),fieldData:s,format:r})})).filter(Boolean).join(Jt(e)?` ${vr[e.combinator]} `:" "),[s,u]=e.not||!a?[(e.not?"!":"")+"(",")"]:["",""];return l?`${s}${l}${u}`:d};return t(e,!0)}if("spel"===r){const t=(e,a)=>{if(!Jr(e,c[e.id??""]))return a?d:"";const l=e.rules.map((e=>{if("string"==typeof e)return e;if(Kt(e))return t(e);const[a,l]=w(e);if(!Jr(e,a,l)||e.field===b||e.operator===g)return"";const s=cr(i,e.field);return(n??o)(e,{parseNumbers:h,escapeQuotes:"value"===(e.valueSource??"value"),fieldData:s,format:r})})).filter(Boolean).join(Jt(e)?` ${e.combinator} `:" "),[s,u]=e.not||!a?[(e.not?"!":"")+"(",")"]:["",""];return l?`${s}${l}${u}`:d};return t(e,!0)}if("jsonata"===r){const t=(e,s)=>{if(!Jr(e,c[e.id??""]))return s?d:"";const u=e.rules.map((e=>{if("string"==typeof e)return e;if(Kt(e))return t(e);const[s,u]=w(e);if(!Jr(e,s,u)||e.field===b||e.operator===g)return"";const c=cr(i,e.field);return(n??o)(e,{parseNumbers:h,escapeQuotes:"value"===(e.valueSource??"value"),fieldData:c,format:r,quoteFieldNamesWith:a,fieldIdentifierSeparator:l})})).filter(Boolean).join(Jt(e)?` ${e.combinator} `:" "),[p,f]=e.not||!s?[(e.not?"$not":"")+"(",")"]:["",""];return u?`${p}${u}${f}`:d};return t(e,!0)}if("jsonlogic"===r){const t=Jt(e)?e:tr(e),a=(e,t)=>{if(!Jr(e,c[e.id??""]))return!1;const l=e.rules.map((e=>{if(Kt(e))return a(e);const[t,l]=w(e);if(!Jr(e,t,l)||e.field===b||e.operator===g)return!1;const s=cr(i,e.field);return(n??o)(e,{parseNumbers:h,fieldData:s,format:r})})).filter(Boolean);if(0===l.length)return!1;const s={[e.combinator]:l};return e.not?{"!":s}:s};return a(t,!0)}if("elasticsearch"===r){const t=Jt(e)?e:tr(e),a=e=>{if(!Jr(e,c[e.id??""]))return!1;const t=e.rules.map((e=>{if(Kt(e))return a(e);const[t,l]=w(e);if(!Jr(e,t,l)||e.field===b||e.operator===g)return!1;const s=cr(i,e.field);return(n??o)(e,{parseNumbers:h,fieldData:s,format:r})})).filter(Boolean);return 0!==t.length&&{bool:e.not?{must_not:"or"===e.combinator?{bool:{should:t}}:t}:{["or"===e.combinator?"should":"must"]:t}}},l=a(t);return!1===l?{}:l}if("natural_language"===r){const t=(e,s)=>{if(!Jr(e,c[e.id??""]))return s?d:"";const p=e.rules.map((s=>{if("string"==typeof s)return`, ${s} `;if(Kt(s))return t(s,1===e.rules.length);const[c,d]=w(s);if(!Jr(s,c,d)||s.field===b||s.operator===g)return"";const p="value"===(s.valueSource??"value"),f=cr(i,s.field);return"function"==typeof n?n(s,{fields:i,parseNumbers:h,escapeQuotes:p,quoteFieldNamesWith:a,fieldIdentifierSeparator:l,fieldData:f,format:r,quoteValuesWith:v,concatOperator:y,getOperators:u}):Zr(s,{fields:i,parseNumbers:h,escapeQuotes:p,valueProcessor:o,quoteFieldNamesWith:a,fieldIdentifierSeparator:l,fieldData:f,format:r,quoteValuesWith:v,concatOperator:y,getOperators:u})}));if(0===p.length)return d;const f=e.not||!s?"(":"",m=e.not||!s?`) is${e.not?" not":""} true`:"";return`${f}${p.filter(Boolean).join(Jt(e)?`, ${e.combinator} `:"")}${m}`};return t(e,!0)}return""}var ro={default:xr,mongodb:Dr,cel:Rr,spel:_r},oo=e=>(t,r,o,n)=>ro[e]({field:t,operator:r,value:o,valueSource:n},{parseNumbers:!1}),no=(oo("default"),oo("mongodb"),oo("cel"),oo("spel"),(e,t)=>{let r=t,o=0;for(;o<e.length&&r&&Kt(r);){const t=r.rules[e[o]];r="string"==typeof t?null:t,o++}return r}),ao=e=>e.slice(0,-1),lo=(e,t)=>e.length===t.length&&e.every(((e,r)=>e===t[r])),so=(e,t)=>{let r=!!t.disabled,o=t,n=0;for(;n<e.length&&!r&&Kt(o);){const t=o.rules[e[n]];Xt(t)&&(Kt(t)||"field"in t&&t.field)&&(r=!!t.disabled,o=t),n++}return r},io=e=>lo([],e.path)?"Query builder":`Rule group at path ${e.path.join("-")}`,uo=globalThis.crypto,co=()=>"00-0-4-2-000".replaceAll(/[^-]/g,(e=>(65536*(Math.random()+Math.trunc(e))>>parseInt(e)).toString(16).padStart(4,"0")));if(uo)if("function"==typeof uo.randomUUID)co=()=>uo.randomUUID();else if("function"==typeof uo.getRandomValues){const e="89ab",t=new Uint32Array(32);co=()=>{uo.getRandomValues(t);let r=(t[0]%16).toString(16);for(let o=1;o<32;o++)r=12===o?`${r}4`:16===o?`${r}${e[t[17]%4]}`:`${r}${(t[o]%16).toString(16)}`,7!==o&&11!==o&&15!==o&&19!==o||(r=`${r}-`);return r}}var po=t=>(0,e.useCallback)(((e,r)=>{e?.preventDefault(),e?.stopPropagation(),t(e,r)}),[t]),fo=e.memo((t=>{const r=ho(t),o=po(r.cloneRule),n=po(r.toggleLockRule),a=po(r.removeRule),l=po(r.shiftRuleUp),s=po(r.shiftRuleDown);return e.createElement("div",{ref:r.dndRef,"data-testid":lt,"data-dragmonitorid":r.dragMonitorId,"data-dropmonitorid":r.dropMonitorId,className:r.outerClassName,"data-rule-id":r.id,"data-level":r.path.length,"data-path":JSON.stringify(r.path)},e.createElement(mo,{...r,cloneRule:o,toggleLockRule:n,removeRule:a,shiftRuleUp:l,shiftRuleDown:s}))})),mo=e.memo((t=>{const{schema:{controls:{shiftActions:r,dragHandle:o,fieldSelector:n,operatorSelector:a,valueSourceSelector:l,valueEditor:s,cloneRuleAction:i,lockRuleAction:u,removeRuleAction:c}}}=t;return e.createElement(e.Fragment,null,t.schema.showShiftActions&&e.createElement(r,{testID:ht,level:t.path.length,path:t.path,titles:{shiftUp:t.translations.shiftActionUp.title,shiftDown:t.translations.shiftActionDown.title},labels:{shiftUp:t.translations.shiftActionUp.label,shiftDown:t.translations.shiftActionDown.label},className:t.classNames.shiftActions,disabled:t.disabled,shiftUp:t.shiftRuleUp,shiftDown:t.shiftRuleDown,shiftUpDisabled:t.shiftUpDisabled,shiftDownDisabled:t.shiftDownDisabled,context:t.context,validation:t.validationResult,schema:t.schema,ruleOrGroup:t.rule}),t.schema.enableDragAndDrop&&e.createElement(o,{testID:bt,ref:t.dragRef,level:t.path.length,path:t.path,title:t.translations.dragHandle.title,label:t.translations.dragHandle.label,className:t.classNames.dragHandle,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema,ruleOrGroup:t.rule}),e.createElement(n,{testID:"fields",options:t.schema.fields,title:t.translations.fields.title,value:t.rule.field,operator:t.rule.operator,className:t.classNames.fields,handleOnChange:t.generateOnChangeHandler("field"),level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema,rule:t.rule}),(t.schema.autoSelectField||t.rule.field!==t.translations.fields.placeholderName)&&e.createElement(e.Fragment,null,e.createElement(a,{testID:"operators",field:t.rule.field,fieldData:t.fieldData,title:t.translations.operators.title,options:t.operators,value:t.rule.operator,className:t.classNames.operators,handleOnChange:t.generateOnChangeHandler("operator"),level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema,rule:t.rule}),(t.schema.autoSelectOperator||t.rule.operator!==t.translations.operators.placeholderName)&&!t.hideValueControls&&e.createElement(e.Fragment,null,!["null","notNull"].includes(t.rule.operator)&&t.valueSources.length>1&&e.createElement(l,{testID:"value-source-selector",field:t.rule.field,fieldData:t.fieldData,title:t.translations.valueSourceSelector.title,options:t.valueSourceOptions,value:t.rule.valueSource??"value",className:t.classNames.valueSource,handleOnChange:t.generateOnChangeHandler("valueSource"),level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema,rule:t.rule}),e.createElement(s,{testID:"value-editor",field:t.rule.field,fieldData:t.fieldData,title:t.translations.value.title,operator:t.rule.operator,value:t.rule.value,valueSource:t.rule.valueSource??"value",type:t.valueEditorType,inputType:t.inputType,values:t.values,listsAsArrays:t.schema.listsAsArrays,parseNumbers:t.schema.parseNumbers,separator:t.valueEditorSeparator,className:t.classNames.value,handleOnChange:t.generateOnChangeHandler("value"),level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema,rule:t.rule}))),t.schema.showCloneButtons&&e.createElement(i,{testID:"clone-rule",label:t.translations.cloneRule.label,title:t.translations.cloneRule.title,className:t.classNames.cloneRule,handleOnClick:t.cloneRule,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.rule,schema:t.schema}),t.schema.showLockButtons&&e.createElement(u,{testID:"lock-rule",label:t.translations.lockRule.label,title:t.translations.lockRule.title,className:t.classNames.lockRule,handleOnClick:t.toggleLockRule,level:t.path.length,path:t.path,disabled:t.disabled,disabledTranslation:t.parentDisabled?void 0:t.translations.lockRuleDisabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.rule,schema:t.schema}),e.createElement(c,{testID:"remove-rule",label:t.translations.removeRule.label,title:t.translations.removeRule.title,className:t.classNames.removeRule,handleOnClick:t.removeRule,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.rule,schema:t.schema}))})),ho=t=>{const{id:r,path:o,rule:n,schema:{classNames:a,fields:l,fieldMap:s,getInputType:i,getOperators:u,getValueEditorType:c,getValueEditorSeparator:d,getValueSources:p,getValues:f,validationMap:m,enableDragAndDrop:h,getRuleClassname:b,suppressStandardClassnames:g},actions:{moveRule:v,onPropChange:y,onRuleRemove:A},disabled:C,parentDisabled:$,shiftUpDisabled:w,shiftDownDisabled:N,field:S,operator:G,value:R,valueSource:E,dropEffect:D="move",dragMonitorId:O="",dropMonitorId:k="",dndRef:I=null,dragRef:_=null,isDragging:x=!1,isOver:q=!1}=t;Ut();const M=!!$||!!C,B=(0,e.useMemo)((()=>n??{id:r,field:S??"",operator:G??"",value:R,valueSource:E}),[S,r,G,n,R,E]),j=(0,e.useMemo)((()=>({shiftActions:$t(g||Ye,a.shiftActions),dragHandle:$t(g||rt,a.dragHandle),fields:$t(g||"rule-fields",a.valueSelector,a.fields),operators:$t(g||"rule-operators",a.valueSelector,a.operators),valueSource:$t(g||"rule-valueSource",a.valueSelector,a.valueSource),value:$t(g||"rule-value",a.value),cloneRule:$t(g||"rule-cloneRule",a.actionElement,a.cloneRule),lockRule:$t(g||"rule-lock",a.actionElement,a.lockRule),removeRule:$t(g||"rule-remove",a.actionElement,a.removeRule),valueListItem:$t(g||nt,a.valueListItem)})),[a.shiftActions,a.dragHandle,a.valueSelector,a.fields,a.operators,a.valueSource,a.value,a.actionElement,a.cloneRule,a.lockRule,a.removeRule,a.valueListItem,g]),T=(0,e.useCallback)((e=>(t,r)=>{M||y(e,t,o)}),[M,y,o]),P=(0,e.useCallback)((()=>{if(!M){const e=[...ao(o),o.at(-1)+1];v(o,e,!0)}}),[M,v,o]),W=(0,e.useCallback)(((e,t)=>{y("disabled",!M,o)}),[M,y,o]),L=(0,e.useCallback)(((e,t)=>{M||A(o)}),[M,A,o]),U=(0,e.useCallback)(((e,t)=>{M||w||v(o,"up",e?.altKey)}),[M,v,o,w]),F=(0,e.useCallback)(((e,t)=>{M||N||v(o,"down",e?.altKey)}),[M,v,o,N]),V=(0,e.useMemo)((()=>s?.[B.field]??{name:B.field,value:B.field,label:B.field}),[s,B.field]),Q=(0,e.useMemo)((()=>V.inputType??i(B.field,B.operator,{fieldData:V})),[V,i,B.field,B.operator]),H=(0,e.useMemo)((()=>u(B.field,{fieldData:V})),[V,u,B.field]),z=(0,e.useMemo)((()=>cr(H,B.operator)),[H,B.operator]),X=z?.arity,K="string"==typeof X&&"unary"===X||"number"==typeof X&&X<2,J=(0,e.useMemo)((()=>"function"==typeof V.valueSources?V.valueSources(B.operator):V.valueSources??p(B.field,B.operator,{fieldData:V})),[V,p,B.field,B.operator]),Y=(0,e.useMemo)((()=>"field"===B.valueSource?"select":c(B.field,B.operator,{fieldData:V})),[V,c,B.field,B.operator,B.valueSource]),Z=(0,e.useMemo)((()=>d(B.field,B.operator,{fieldData:V})),[V,d,B.field,B.operator]),ee=(0,e.useMemo)((()=>"field"===B.valueSource?mr(V,l,B.operator):V.values??f(B.field,B.operator,{fieldData:V})),[V,l,f,B.field,B.operator,B.valueSource]),te=(0,e.useMemo)((()=>J.map((e=>({name:e,value:e,label:e})))),[J]),re=(0,e.useMemo)((()=>m[r??""]??("function"==typeof V.validator?V.validator(B):null)),[V,r,B,m]),oe=(0,e.useMemo)((()=>Ro(re)),[re]),ne=(0,e.useMemo)((()=>V?.className??""),[V?.className]),ae=(0,e.useMemo)((()=>z?.className??""),[z?.className]),le=(0,e.useMemo)((()=>$t(b(B,{fieldData:V}),ne,ae,g||"rule",a.rule,M&&a.disabled,x&&a.dndDragging,q&&a.dndOver,q&&"copy"===D&&a.dndCopy,g||{[ot]:M,[Ze]:x,[et]:q,[tt]:q&&"copy"===D},oe)),[a.disabled,a.dndCopy,a.dndDragging,a.dndOver,a.rule,M,D,ne,V,b,x,q,ae,B,g,oe]);return{...t,classNames:j,cloneRule:P,disabled:M,dndRef:I,dragMonitorId:O,dragRef:_,dropMonitorId:k,fieldData:V,generateOnChangeHandler:T,hideValueControls:K,inputType:Q,operators:H,outerClassName:le,removeRule:L,rule:B,shiftRuleUp:U,shiftRuleDown:F,toggleLockRule:W,validationResult:re,valueEditorSeparator:Z,valueEditorType:Y,values:ee,valueSourceOptions:te,valueSources:J}},bo=e.memo((t=>{const r=yo(t),{schema:{controls:{ruleGroupBodyElements:o,ruleGroupHeaderElements:n}}}=r,a=po(r.addRule),l=po(r.addGroup),s=po(r.cloneGroup),i=po(r.toggleLockGroup),u=po(r.removeGroup),c=po(r.shiftGroupUp),d=po(r.shiftGroupDown);return e.createElement("div",{ref:r.previewRef,title:r.accessibleDescription,className:r.outerClassName,"data-testid":st,"data-dragmonitorid":r.dragMonitorId,"data-dropmonitorid":r.dropMonitorId,"data-rule-group-id":r.id,"data-level":r.path.length,"data-path":JSON.stringify(r.path)},e.createElement("div",{ref:r.dropRef,className:r.classNames.header},e.createElement(n,{...r,addRule:a,addGroup:l,cloneGroup:s,toggleLockGroup:i,removeGroup:u,shiftGroupUp:c,shiftGroupDown:d})),e.createElement("div",{className:r.classNames.body},e.createElement(o,{...r,addRule:a,addGroup:l,cloneGroup:s,toggleLockGroup:i,removeGroup:u,shiftGroupUp:c,shiftGroupDown:d})))})),go=e.memo((t=>{const{schema:{controls:{shiftActions:r,dragHandle:o,combinatorSelector:n,notToggle:a,addRuleAction:l,addGroupAction:s,cloneGroupAction:i,lockGroupAction:u,removeGroupAction:c}}}=t;return e.createElement(e.Fragment,null,t.schema.showShiftActions&&t.path.length>0&&e.createElement(r,{key:ht,testID:ht,level:t.path.length,path:t.path,titles:{shiftUp:t.translations.shiftActionUp.title,shiftDown:t.translations.shiftActionDown.title},labels:{shiftUp:t.translations.shiftActionUp.label,shiftDown:t.translations.shiftActionDown.label},className:t.classNames.shiftActions,disabled:t.disabled,shiftUp:t.shiftGroupUp,shiftDown:t.shiftGroupDown,shiftUpDisabled:t.shiftUpDisabled,shiftDownDisabled:t.shiftDownDisabled,context:t.context,validation:t.validationResult,schema:t.schema,ruleOrGroup:t.ruleGroup}),t.path.length>0&&t.schema.enableDragAndDrop&&e.createElement(o,{key:bt,testID:bt,ref:t.dragRef,level:t.path.length,path:t.path,title:t.translations.dragHandle.title,label:t.translations.dragHandle.label,className:t.classNames.dragHandle,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema,ruleOrGroup:t.ruleGroup}),!t.schema.showCombinatorsBetweenRules&&!t.schema.independentCombinators&&e.createElement(n,{key:ft,testID:ft,options:t.schema.combinators,value:t.combinator,title:t.translations.combinators.title,className:t.classNames.combinators,handleOnChange:t.onCombinatorChange,rules:t.ruleGroup.rules,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,schema:t.schema}),t.schema.showNotToggle&&e.createElement(a,{key:mt,testID:mt,className:t.classNames.notToggle,title:t.translations.notToggle.title,label:t.translations.notToggle.label,checked:t.ruleGroup.not,handleOnChange:t.onNotToggleChange,level:t.path.length,disabled:t.disabled,path:t.path,context:t.context,validation:t.validationResult,schema:t.schema,ruleGroup:t.ruleGroup}),e.createElement(l,{key:pt,testID:pt,label:t.translations.addRule.label,title:t.translations.addRule.title,className:t.classNames.addRule,handleOnClick:t.addRule,rules:t.ruleGroup.rules,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.ruleGroup,schema:t.schema}),e.createElement(s,{key:ut,testID:ut,label:t.translations.addGroup.label,title:t.translations.addGroup.title,className:t.classNames.addGroup,handleOnClick:t.addGroup,rules:t.ruleGroup.rules,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.ruleGroup,schema:t.schema}),t.schema.showCloneButtons&&t.path.length>0&&e.createElement(i,{key:dt,testID:dt,label:t.translations.cloneRuleGroup.label,title:t.translations.cloneRuleGroup.title,className:t.classNames.cloneGroup,handleOnClick:t.cloneGroup,rules:t.ruleGroup.rules,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.ruleGroup,schema:t.schema}),t.schema.showLockButtons&&e.createElement(u,{key:gt,testID:gt,label:t.translations.lockGroup.label,title:t.translations.lockGroup.title,className:t.classNames.lockGroup,handleOnClick:t.toggleLockGroup,rules:t.ruleGroup.rules,level:t.path.length,path:t.path,disabled:t.disabled,disabledTranslation:t.parentDisabled?void 0:t.translations.lockGroupDisabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.ruleGroup,schema:t.schema}),t.path.length>0&&e.createElement(c,{key:ct,testID:ct,label:t.translations.removeGroup.label,title:t.translations.removeGroup.title,className:t.classNames.removeGroup,handleOnClick:t.removeGroup,rules:t.ruleGroup.rules,level:t.path.length,path:t.path,disabled:t.disabled,context:t.context,validation:t.validationResult,ruleOrGroup:t.ruleGroup,schema:t.schema}))})),vo=e.memo((t=>{const{schema:{controls:{combinatorSelector:r,inlineCombinator:o,ruleGroup:n,rule:a}}}=t;return t.ruleGroup.rules.map(((l,s,{length:i})=>{const u=t.pathsMemo[s],c=u.path,d=u.disabled||"string"!=typeof l&&l.disabled,p=lo([0],c),f=0===t.path.length&&s===i-1,m="string"==typeof l?[...c,l].join("-"):l.id;return e.createElement(e.Fragment,{key:m},s>0&&!t.schema.independentCombinators&&t.schema.showCombinatorsBetweenRules&&e.createElement(o,{key:it,options:t.schema.combinators,value:t.combinator,title:t.translations.combinators.title,className:t.classNames.combinators,handleOnChange:t.onCombinatorChange,rules:t.ruleGroup.rules,level:t.path.length,context:t.context,validation:t.validationResult,component:r,path:c,disabled:t.disabled,schema:t.schema}),"string"==typeof l?e.createElement(o,{key:`${it}-independent`,options:t.schema.combinators,value:l,title:t.translations.combinators.title,className:t.classNames.combinators,handleOnChange:e=>t.onIndependentCombinatorChange(e,s),rules:t.ruleGroup.rules,level:t.path.length,context:t.context,validation:t.validationResult,component:r,path:c,disabled:d,schema:t.schema}):Kt(l)?e.createElement(n,{key:st,id:l.id,schema:t.schema,actions:t.actions,path:c,translations:t.translations,ruleGroup:l,rules:l.rules,combinator:Jt(l)?l.combinator:void 0,not:!!l.not,disabled:d,parentDisabled:t.parentDisabled||t.disabled,shiftUpDisabled:p,shiftDownDisabled:f,context:t.context}):e.createElement(a,{key:lt,id:l.id,rule:l,field:l.field,operator:l.operator,value:l.value,valueSource:l.valueSource,schema:t.schema,actions:t.actions,path:c,disabled:d,parentDisabled:t.parentDisabled||t.disabled,translations:t.translations,shiftUpDisabled:p,shiftDownDisabled:f,context:t.context}))}))})),yo=t=>{const{id:r,path:o,ruleGroup:n,schema:{qbId:a,accessibleDescriptionGenerator:l,classNames:s,combinators:i,createRule:u,createRuleGroup:c,disabledPaths:d,independentCombinators:p,validationMap:f,enableDragAndDrop:m,getRuleGroupClassname:h,suppressStandardClassnames:b},actions:{onGroupAdd:g,onGroupRemove:v,onPropChange:y,onRuleAdd:A,moveRule:C},disabled:$,parentDisabled:w,shiftUpDisabled:N,shiftDownDisabled:S,combinator:G,rules:R,not:E,dropEffect:D="move",dragMonitorId:O="",dropMonitorId:k="",previewRef:I=null,dragRef:_=null,dropRef:x=null,isDragging:q=!1,isOver:M=!1}=t;Ut();const B=!!w||!!$,j=(0,e.useMemo)((()=>n&&Jt(n)?n.combinator:n?dr(i):G??dr(i)),[G,i,n]),T=(0,e.useMemo)((()=>{if(n){if(n.combinator===j||p)return n;const e=structuredClone(n);return e.combinator=j,e}return{rules:R,not:E}}),[j,p,E,n,R]),P=(0,e.useMemo)((()=>({header:$t(b||"ruleGroup-header",s.header,M&&"copy"===D&&s.dndCopy,b||{[et]:M,[tt]:M&&"copy"===D}),shiftActions:$t(b||Ye,s.shiftActions),dragHandle:$t(b||rt,s.dragHandle),combinators:$t(b||"ruleGroup-combinators",s.valueSelector,s.combinators),notToggle:$t(b||"ruleGroup-notToggle",s.notToggle),addRule:$t(b||"ruleGroup-addRule",s.actionElement,s.addRule),addGroup:$t(b||"ruleGroup-addGroup",s.actionElement,s.addGroup),cloneGroup:$t(b||"ruleGroup-cloneGroup",s.actionElement,s.cloneGroup),lockGroup:$t(b||"ruleGroup-lock",s.actionElement,s.lockGroup),removeGroup:$t(b||"ruleGroup-remove",s.actionElement,s.removeGroup),body:$t(b||"ruleGroup-body",s.body)})),[s.actionElement,s.addGroup,s.addRule,s.body,s.cloneGroup,s.combinators,s.dndCopy,s.dragHandle,s.header,s.lockGroup,s.notToggle,s.removeGroup,s.shiftActions,s.valueSelector,D,M,b]),W=(0,e.useCallback)((e=>{B||y("combinator",e,o)}),[B,y,o]),L=(0,e.useCallback)(((e,t,r)=>{B||y("combinator",e,[...o,t])}),[B,y,o]),U=(0,e.useCallback)(((e,t)=>{B||y("not",e,o)}),[B,y,o]),F=(0,e.useCallback)(((e,t)=>{if(!B){const e=u();A(e,o,t)}}),[u,B,A,o]),V=(0,e.useCallback)(((e,t)=>{if(!B){const e=c(p);g(e,o,t)}}),[c,B,p,g,o]),Q=(0,e.useCallback)((()=>{if(!B){const e=[...ao(o),o.at(-1)+1];C(o,e,!0)}}),[B,C,o]),H=(0,e.useCallback)(((e,t)=>{B||N||C(o,"up",e?.altKey)}),[B,C,o,N]),z=(0,e.useCallback)(((e,t)=>{B||S||C(o,"down",e?.altKey)}),[B,C,o,S]),X=(0,e.useCallback)((()=>{y("disabled",!B,o)}),[B,y,o]),K=(0,e.useCallback)((()=>{B||v(o)}),[B,v,o]),J=(0,e.useMemo)((()=>f[r??""]),[r,f]),Y=(0,e.useMemo)((()=>Ro(J)),[J]),Z=(0,e.useMemo)((()=>p?null:cr(i,j)?.className??""),[j,i,p]),ee=(0,e.useMemo)((()=>h(T)),[h,T]),te=(0,e.useMemo)((()=>$t(ee,Z,b||"ruleGroup",s.ruleGroup,B&&s.disabled,q&&s.dndDragging,b||{[ot]:B,[Ze]:q},Y)),[s.disabled,s.dndDragging,s.ruleGroup,Z,B,q,ee,b,Y]),re=(0,e.useMemo)((()=>{const e=[];for(let t=0;t<T.rules.length;t++){const r=[...o,t];e[t]={path:r,disabled:B||d.some((e=>lo(r,e)))}}return e}),[B,o,T.rules.length,d]),oe=(0,e.useMemo)((()=>l({path:o,qbId:a})),[l,o,a]);return{...t,addGroup:V,addRule:F,accessibleDescription:oe,classNames:P,cloneGroup:Q,combinator:j,disabled:B,dragMonitorId:O,dragRef:_,dropMonitorId:k,dropRef:x,isDragging:q,isOver:M,onCombinatorChange:W,onGroupAdd:g,onIndependentCombinatorChange:L,onNotToggleChange:U,outerClassName:te,parentDisabled:w,pathsMemo:re,previewRef:I,removeGroup:K,ruleGroup:T,shiftGroupUp:H,shiftGroupDown:z,toggleLockGroup:X,validationClassName:Y,validationResult:J}},Ao=t=>{const{onChange:r,val:o}=Co(t),n=(t=>{const{multiple:r,onChange:o}=t;return(0,e.useMemo)((()=>r?e=>o(Array.from(e.target.selectedOptions).map((e=>e.value))):e=>o(e.target.value)),[r,o])})({multiple:t.multiple,onChange:r});return e.createElement("select",{"data-testid":t.testID,className:t.className,value:o,title:t.title,disabled:t.disabled,multiple:!!t.multiple,onChange:n},Po(t.options))},Co=t=>{const{handleOnChange:r,listsAsArrays:o=!1,multiple:n=!1,value:a}=t;return{onChange:(0,e.useCallback)((e=>{if(n){const t=Ht(e);r(o?t:Vt(t,","))}else r(e)}),[r,o,n]),val:(0,e.useMemo)((()=>n?Ht(a):a),[n,a])}},$o={actionElement:Fe,addGroupAction:Fe,addRuleAction:Fe,cloneGroupAction:Fe,cloneRuleAction:Fe,combinatorSelector:Ao,dragHandle:Ve,fieldSelector:Ao,inlineCombinator:t=>{const{component:r,...o}=t,n=$t(o.schema.suppressStandardClassnames||"betweenRules",o.schema.classNames.betweenRules);return e.createElement("div",{className:n,"data-testid":it},e.createElement(r,{...o,testID:ft}))},lockGroupAction:Fe,lockRuleAction:Fe,notToggle:t=>e.createElement("label",{"data-testid":t.testID,className:t.className,title:t.title},e.createElement("input",{type:"checkbox",onChange:e=>t.handleOnChange(e.target.checked),checked:!!t.checked,disabled:t.disabled}),t.label),operatorSelector:Ao,removeGroupAction:Fe,removeRuleAction:Fe,rule:fo,ruleGroup:bo,ruleGroupBodyElements:vo,ruleGroupHeaderElements:go,shiftActions:t=>e.createElement("div",{"data-testid":t.testID,className:t.className},e.createElement("button",{disabled:t.disabled||t.shiftUpDisabled,onClick:t.shiftUp,title:t.titles?.shiftUp},t.labels?.shiftUp),e.createElement("button",{disabled:t.disabled||t.shiftDownDisabled,onClick:t.shiftDown,title:t.titles?.shiftDown},t.labels?.shiftDown)),valueEditor:t=>{const{operator:r,value:o,handleOnChange:n,title:a,className:l,type:s="text",inputType:i="text",values:u=[],listsAsArrays:c,fieldData:d,disabled:p,separator:f=null,testID:m,selectorComponent:h=t.schema.controls.valueSelector,...b}=t,{valueAsArray:g,multiValueHandler:v,parseNumberMethod:y,valueListItemClassName:A}=(t=>{const{handleOnChange:r,inputType:o,operator:n,value:a,listsAsArrays:l,parseNumbers:s,values:i,type:u,skipHook:c,schema:{classNames:d,suppressStandardClassnames:p}}=t;(0,e.useEffect)((()=>{c||"multiselect"===u||["between","notBetween","in","notIn"].includes(n)||!(Array.isArray(a)||"number"===o&&"string"==typeof a&&a.includes(","))||r(Ht(a,{retainEmptyStrings:!0})[0]??"")}),[r,o,n,c,u,a]);const f=(0,e.useMemo)((()=>Ht(a,{retainEmptyStrings:!0})),[a]),m=(0,e.useMemo)((()=>{if("string"==typeof s){const[e,t]=s.split("-");return"limited"===t?"number"===o&&e:e}return!!s&&"strict"}),[o,s]),h=(0,e.useCallback)(((e,t)=>{const o=ge(f,(r=>{r[t]=hr(e,{parseNumbers:m}),0!==t||"between"!==n&&"notBetween"!==n||!(r.length<2||void 0===r[1])||(r[1]=dr(i))}));r(l?o:Vt(o,","))}),[r,l,n,m,f,i]),b=wt(p||nt,d?.valueListItem);return{valueAsArray:f,multiValueHandler:h,parseNumberMethod:m,valueListItemClassName:b}})(t);if("null"===r||"notNull"===r)return null;const C=d?.placeholder??"",$=["in","notIn"].includes(r)?"text":i||"text";if(!("between"!==r&&"notBetween"!==r||"select"!==s&&"text"!==s)){const r=["from","to"].map(((r,o)=>"text"===s?e.createElement("input",{key:r,type:$,placeholder:C,value:g[o]??"",className:A,disabled:p,onChange:e=>v(e.target.value,o)}):e.createElement(h,{key:r,...b,schema:t.schema,className:A,handleOnChange:e=>v(e,o),disabled:p,value:g[o]??dr(u),options:u,listsAsArrays:c})));return e.createElement("span",{"data-testid":m,className:l,title:a},r[0],f,r[1])}switch(s){case"select":case"multiselect":return e.createElement(h,{...b,schema:t.schema,testID:m,className:l,title:a,handleOnChange:n,disabled:p,value:o,options:u,multiple:"multiselect"===s,listsAsArrays:c});case"textarea":return e.createElement("textarea",{"data-testid":m,placeholder:C,value:o,title:a,className:l,disabled:p,onChange:e=>n(e.target.value)});case"switch":case"checkbox":return e.createElement("input",{"data-testid":m,type:"checkbox",className:l,title:a,onChange:e=>n(e.target.checked),checked:!!o,disabled:p});case"radio":return e.createElement("span",{"data-testid":m,className:l,title:a},u.map((t=>e.createElement("label",{key:t.name},e.createElement("input",{type:"radio",value:t.name,disabled:p,checked:o===t.name,onChange:e=>n(e.target.value)}),t.label))))}return e.createElement("input",{"data-testid":m,type:$,placeholder:C,value:o,title:a,className:l,disabled:p,onChange:e=>n(hr(e.target.value,{parseNumbers:y}))})},valueSelector:Ao,valueSourceSelector:Ao},wo=(e,t,r)=>((e,t,r)=>e?((e,t)=>!1!==e&&(!!e||!1!==t))(t,r):((e,t)=>!!e||!1!==e&&!!t)(t,r))(e,t,r),No=()=>null,So=(0,e.forwardRef)(No),Go={},Ro=e=>{const t="boolean"==typeof e?e:"object"==typeof e&&null!==e?e.valid:null;return"boolean"==typeof t?t?Ke:Je:""},Eo=["value"],Do={name:"name",value:"name",valueSources:null,label:"label"},Oo=(e,t)=>$t(t.map((t=>$t(t?.[e])))),ko=(...e)=>({queryBuilder:Oo("queryBuilder",e),ruleGroup:Oo("ruleGroup",e),header:Oo("header",e),body:Oo("body",e),combinators:Oo("combinators",e),addRule:Oo("addRule",e),addGroup:Oo("addGroup",e),cloneRule:Oo("cloneRule",e),cloneGroup:Oo("cloneGroup",e),removeGroup:Oo("removeGroup",e),rule:Oo("rule",e),fields:Oo("fields",e),operators:Oo("operators",e),value:Oo("value",e),removeRule:Oo("removeRule",e),notToggle:Oo("notToggle",e),shiftActions:Oo("shiftActions",e),dragHandle:Oo("dragHandle",e),lockRule:Oo("lockRule",e),lockGroup:Oo("lockGroup",e),valueSource:Oo("valueSource",e),actionElement:Oo("actionElement",e),valueSelector:Oo("valueSelector",e),betweenRules:Oo("betweenRules",e),valid:Oo("valid",e),invalid:Oo("invalid",e),dndDragging:Oo("dndDragging",e),dndOver:Oo("dndOver",e),dndCopy:Oo("dndCopy",e),disabled:Oo("disabled",e),valueListItem:Oo("valueListItem",e),branches:Oo("branches",e)}),Io=Object.keys,_o=Object.entries,xo=(e,t,r)=>{const o=_o(t).map((([t,[o,n]])=>[t,o??n??(r?He:{})[e]?.[t]])).filter((e=>!!e[1]));return o.length>0?{[e]:Object.fromEntries(o)}:void 0},qo=(e,{idGenerator:t=co}={})=>ge(e,(e=>{e.id||(e.id=t())})),Mo=(e,{idGenerator:t=co}={})=>ge(e,(e=>{e.id||(e.id=t()),e.rules=e.rules.map((e=>"string"==typeof e?e:Kt(e)?Mo(e,{idGenerator:t}):qo(e,{idGenerator:t})))})),Bo=(e,{idGenerator:t=co}={})=>structuredClone({...e,id:t()}),jo=(e,{idGenerator:t=co}={})=>{if(!Xt(e))return e;if(!Kt(e))return structuredClone({...e,id:t()});if(Jt(e)){const r=e.rules.map((e=>Kt(e)?jo(e,{idGenerator:t}):Bo(e,{idGenerator:t})));return{...e,id:t(),rules:r}}const r=e.rules.map((e=>"string"==typeof e?e:Kt(e)?jo(e,{idGenerator:t}):Bo(e,{idGenerator:t})));return{...e,id:t(),rules:r}},To=(e,t,r,{combinators:o=Xe,combinatorPreceding:n,idGenerator:a=co}={})=>ge(e,(e=>{const l=no(r,e);if(l&&Kt(l)){if(Yt(l)&&l.rules.length>0){const e=l.rules.at(-2);l.rules.push(n??("string"==typeof e?e:dr(o)))}l.rules.push(((e,{idGenerator:t=co}={})=>Kt(e)?Mo(e,{idGenerator:t}):qo(e,{idGenerator:t}))(t,{idGenerator:a}))}})),Po=t=>ir(t)?t.map((t=>e.createElement("optgroup",{key:t.label,label:t.label},t.options.map((t=>e.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label)))))):Array.isArray(t)?t.map((t=>e.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label))):null,Wo={},Lo={},Uo=[],Fo={},Vo=()=>null,Qo=()=>"",Ho=()=>!0,zo=(...e)=>{console.log(...e)};function Xo(t,r){const{query:o,defaultQuery:n,getValueEditorSeparator:a=Vo,getRuleClassname:l=Qo,getRuleGroupClassname:s=Qo,onAddRule:i=Ho,onAddGroup:u=Ho,onMoveRule:c=Ho,onMoveGroup:d=Ho,onRemove:p=Ho,onQueryChange:f,showCombinatorsBetweenRules:m=!1,showNotToggle:h=!1,showShiftActions:b=!1,showCloneButtons:g=!1,showLockButtons:v=!1,suppressStandardClassnames:y=!1,resetOnFieldChange:A=!0,resetOnOperatorChange:C=!1,autoSelectField:$=!0,autoSelectOperator:w=!0,addRuleToNewGroups:N=!1,listsAsArrays:S=!1,parseNumbers:G=!1,disabled:R=!1,validator:E,onLog:D=zo,idGenerator:O,accessibleDescriptionGenerator:k=io}=t,{qbId:I,rqbContext:_,fields:x,fieldMap:q,combinators:M,getOperatorsMain:B,getRuleDefaultOperator:j,getValueEditorTypeMain:T,getValueSourcesMain:P,getValuesMain:W,getRuleDefaultValue:L,getInputTypeMain:U,createRule:F,createRuleGroup:V}=r,{controlClassnames:Q,controlElements:H,debugMode:z,enableDragAndDrop:X,enableMountQueryChange:K,translations:J}=_,Y=!!m,Z=!!h,ee=!!b,te=!!g,re=!!v,oe=!!A,ne=!!C,ae=!!$,le=!!w,se=!!N,ie=!!S,ue=!!y,ce=(0,e.useCallback)(((...e)=>{z&&D(...e)}),[z,D]);(t=>{Pt();const{defaultQuery:r,queryProp:o}=t;(t=>{const r=(0,e.useRef)({value:t,prev:null}),o=r.current.value;t!==o&&(r.current={value:t,prev:o}),r.current.prev})(!!o)})({defaultQuery:n,queryProp:o});const de=Wt(),pe=Pt(),fe=(0,e.useMemo)((()=>jt(I)),[I]),me=(t=>{const r=e.useContext(Ue);return Bt(t,void 0)??r?.initialQuery})(fe),he=(0,e.useCallback)((()=>fe(de.getState())),[de,fe]),be=(0,e.useMemo)((()=>V()),[V]),ve=o??me??n??be,ye=ve.id?ve:Mo(ve,{idGenerator:O}),[Ae]=(0,e.useState)(ye),Ce=(0,e.useMemo)((()=>({..._,initialQuery:Ae})),[_,Ae]);(0,e.useEffect)((()=>{o&&!Object.is(o,me)&&pe(Tt({payload:{qbId:I,query:o},onQueryChange:void 0}))}),[o,I,me,pe]);const $e=(0,e.useMemo)((()=>Yt(ye)),[ye]),we=!!t.independentCombinators&&!$e;Ut(0,we||!we&&t.independentCombinators);const Ne=(0,e.useRef)(!1);(0,e.useEffect)((()=>{Ne.current||(Ne.current=!0,pe(Tt({payload:{qbId:I,query:ye},onQueryChange:K&&"function"==typeof f?f:void 0})))}),[K,f,I,pe,ye]);const Se=(0,e.useCallback)((e=>{pe(Tt({payload:{qbId:I,query:e},onQueryChange:f}))}),[f,I,pe]),Ge=(0,e.useMemo)((()=>Array.isArray(R)&&R||Uo),[R]),Re=!0===R,Ee=(0,e.useMemo)((()=>ye.disabled||Ge.some((e=>0===e.length))),[Ge,ye.disabled]),De=(0,e.useCallback)(((e,t,r)=>{const o=jt(I)(de.getState());if(!o)return;if(so(t,o)||Re)return void ce({qbId:I,type:vt,rule:e,parentPath:t,query:o});const n=i(e,t,o,r);if(!n)return void ce({qbId:I,type:"onAddRule callback returned false",rule:e,parentPath:t,query:o});const a=!0===n?e:n,l=To(o,a,t,{combinators:M,combinatorPreceding:a.combinatorPreceding??void 0});ce({qbId:I,type:At,query:o,newQuery:l,newRule:a,parentPath:t}),Se(l)}),[I,de,Re,i,M,Se,ce]),Oe=(0,e.useCallback)(((e,t,r)=>{const o=jt(I)(de.getState());if(!o)return;if(so(t,o)||Re)return void ce({qbId:I,type:vt,ruleGroup:e,parentPath:t,query:o});const n=u(e,t,o,r);if(!n)return void ce({qbId:I,type:"onAddGroup callback returned false",ruleGroup:e,parentPath:t,query:o});const a=!0===n?e:n,l=To(o,a,t,{combinators:M,combinatorPreceding:a.combinatorPreceding??void 0});ce({qbId:I,type:At,query:o,newQuery:l,newGroup:a,parentPath:t}),Se(l)}),[I,de,Re,u,M,ce,Se]),ke=(0,e.useCallback)(((e,t,r)=>{const o=jt(I)(de.getState());if(!o)return;if(so(r,o)&&"disabled"!==e||Re)return void ce({qbId:I,type:yt,path:r,prop:e,value:t,query:o});const n=((e,t,r,o,{resetOnFieldChange:n=!0,resetOnOperatorChange:a=!1,getRuleDefaultOperator:l=()=>"=",getValueSources:s=()=>["value"],getRuleDefaultValue:i=()=>""}={})=>ge(e,(e=>{if("combinator"===t&&!Jt(e)){const t=no(ao(o),e).rules;return void(o.at(-1)%2==1&&(t[o.at(-1)]=r))}const u=no(o,e);if(!u)return;const c=Kt(u);if(u[t]===r)return;if("valueSource"!==t&&(u[t]=r),c)return;let d=!1,p=!1;n&&"field"===t&&(u.operator=l(r),d=!0,p=!0),a&&"operator"===t&&(d=!0,p=!0);const f=s(u.field,u.operator)[0];(d&&u.valueSource&&f!==u.valueSource||"valueSource"===t&&r!==u.valueSource)&&(p=!!u.valueSource||!u.valueSource&&r!==f,u.valueSource=d?f:r),p&&(u.value=i(u))})))(o,e,t,r,{resetOnFieldChange:oe,resetOnOperatorChange:ne,getRuleDefaultOperator:j,getValueSources:P,getRuleDefaultValue:L});ce({qbId:I,type:"rule or group updated",query:o,newQuery:n,prop:e,value:t,path:r}),Se(n)}),[I,de,Re,oe,ne,j,P,L,ce,Se]),Ie=(0,e.useCallback)(((e,t)=>{const r=jt(I)(de.getState());if(!r)return;if(so(e,r)||Re)return void ce({qbId:I,type:yt,path:e,query:r});const o=no(e,r);if(o)if(p(o,e,r,t)){const t=((e,t)=>0===t.length||!Jt(e)&&!no(t,e)?e:ge(e,(e=>{const r=t.at(-1),o=no(ao(t),e);if(o&&Kt(o))if(!Jt(o)&&o.rules.length>1){const e=0===r?0:r-1;o.rules.splice(e,2)}else o.rules.splice(r,1)})))(r,e);ce({qbId:I,type:"rule or group removed",query:r,newQuery:t,path:e,ruleOrGroup:o}),Se(t)}else ce({qbId:I,type:"onRemove callback returned false",ruleOrGroup:o,path:e,query:r})}),[I,de,Re,ce,p,Se]),_e=(0,e.useCallback)(((e,t,r,o)=>{const n=jt(I)(de.getState());if(!n)return;if(so(e,n)||Re)return void ce({qbId:I,type:yt,oldPath:e,newPath:t,query:n});const a=((e,t,r,{clone:o=!1,combinators:n=Xe,idGenerator:a=co}={})=>{const l=((e,t,r)=>{if(Array.isArray(r))return r;const o=Yt(e);if("up"===r){if(lo(t,[0]))return t;if(0===t.at(-1)){const e=ao(t);return[...ao(e),Math.max(0,e.at(-1)-(o?1:0))]}{const r=[...ao(t),Math.max(0,t.at(-1)-(o?2:1))],n=no(r,e);return Kt(n)?[...r,n.rules.length]:[...ao(t),Math.max(0,t.at(-1)-(o?3:1))]}}if("down"===r){if(lo([e.rules.length-1],t))return t;if(t.at(-1)===no(ao(t),e).rules.length-1){const e=ao(t);return[...ao(e),e.at(-1)+1]}{const r=[...ao(t),t.at(-1)+(o?2:1)],n=no(r,e);return Kt(n)?[...r,0]:[...ao(t),t.at(-1)+(o?3:2)]}}return t})(e,t,r);if(0===t.length||lo(t,l)||!no(ao(l),e))return e;const s=no(t,e);if(!s)return e;const i=o?jo(s,{idGenerator:a}):s;return ge(e,(e=>{const r=Yt(e),a=no(ao(t),e),s=t.at(-1),u=r&&s>0?a.rules[s-1]:null,c=r&&s<a.rules.length-1?a.rules[s+1]:null;if(!o){const e=r?Math.max(0,s-1):s,t=r?2:1;a.rules.splice(e,t)}const d=[...l],p=((e,t)=>{const r=[],o=ao(e),n=ao(t);let a=0;for(;a<o.length&&a<n.length&&o[a]===n[a];)r.push(n[a]),a++;return r})(t,l);!o&&t.length===p.length+1&&l[p.length]>t[p.length]&&(d[p.length]-=r?2:1);const f=ao(d),m=no(f,e),h=d.at(-1),b=(...e)=>m.rules.splice(h,0,...e);if(0!==m.rules.length&&r)if(0===h)if(0===s&&c)b(i,c);else{const e=m.rules[1]??u??dr(n);b(i,e)}else b(u||(m.rules[h-2]??c??dr(n)),i);else b(i)}))})(n,e,t,{clone:r,combinators:M}),l=no(e,n),s=Kt(l),i=(s?d:c)(l,e,t,n,a,{clone:r,combinators:M},o);if(!i)return void ce({qbId:I,type:s?"onMoveGroup callback returned false":"onMoveRule callback returned false",ruleOrGroup:l,oldPath:e,newPath:t,clone:r,query:n,nextQuery:a});const u=Kt(i)?i:a;ce({qbId:I,type:"rule or group moved",query:n,newQuery:u,oldPath:e,newPath:t,clone:r}),Se(u)}),[I,de,Re,M,d,c,ce,Se]),{validationResult:xe,validationMap:qe}=(0,e.useMemo)((()=>{const e="function"==typeof E&&ye?E(ye):Wo;return{validationResult:e,validationMap:"boolean"==typeof e?Lo:e}}),[ye,E]),Me=(0,e.useMemo)((()=>X?"enabled":"disabled"),[X]),Be=(0,e.useMemo)((()=>$e||Y?"enabled":"disabled"),[$e,Y]),je=(0,e.useMemo)((()=>"string"==typeof ye.combinator?{combinator:ye.combinator}:Fo),[ye.combinator]),Te=(0,e.useMemo)((()=>$t(ue||"queryBuilder",$t(Q.queryBuilder),Re&&Q.disabled,"boolean"==typeof xe&&xe&&Q.valid,"boolean"==typeof xe&&!xe&&Q.invalid,ue||{[ot]:Re,[Ke]:"boolean"==typeof xe&&xe,[Je]:"boolean"==typeof xe&&!xe})),[Q.disabled,Q.invalid,Q.queryBuilder,Q.valid,Re,ue,xe]),Pe=(0,e.useMemo)((()=>({addRuleToNewGroups:se,accessibleDescriptionGenerator:k,autoSelectField:ae,autoSelectOperator:le,classNames:Q,combinators:M,controls:H,createRule:F,createRuleGroup:V,disabledPaths:Ge,enableDragAndDrop:X,fieldMap:q,fields:x,dispatchQuery:Se,getQuery:he,getInputType:U,getOperators:B,getRuleClassname:l,getRuleGroupClassname:s,getValueEditorSeparator:a,getValueEditorType:T,getValues:W,getValueSources:P,independentCombinators:$e,listsAsArrays:ie,parseNumbers:G,qbId:I,showCloneButtons:te,showCombinatorsBetweenRules:Y,showLockButtons:re,showNotToggle:Z,showShiftActions:ee,suppressStandardClassnames:ue,validationMap:qe})),[k,se,ae,le,M,Q,H,F,V,Ge,Se,X,q,x,U,B,he,l,s,a,T,W,P,$e,ie,G,I,te,Y,re,Z,ee,ue,qe]);return{actions:(0,e.useMemo)((()=>({moveRule:_e,onGroupAdd:Oe,onGroupRemove:Ie,onPropChange:ke,onRuleAdd:De,onRuleRemove:Ie})),[_e,Oe,ke,De,Ie]),rootGroup:ye,rootGroupDisabled:Ee,queryDisabled:Re,rqbContext:Ce,schema:Pe,translations:J,wrapperClassName:Te,dndEnabledAttr:Me,inlineCombinatorsAttr:Be,combinatorPropObject:je}}var Ko=(e,t,r)=>{const o=dr(e);if("between"===t.operator||"notBetween"===t.operator){const e=[o,o];return r?e:Vt(e.map((e=>e??"")),",")}return o},Jo=t=>{const[r]=(0,e.useState)(co),{fields:o,baseField:n,operators:a,baseOperator:l,combinators:s=Xe,baseCombinator:i,translations:u,enableMountQueryChange:c=!0,controlClassnames:d,controlElements:p,getDefaultField:f,getDefaultOperator:m,getDefaultValue:h,getOperators:b,getValueEditorType:g,getValueSources:v,getInputType:y,getValues:A,autoSelectField:C=!0,autoSelectOperator:$=!0,addRuleToNewGroups:w=!1,enableDragAndDrop:N,listsAsArrays:S=!1,debugMode:G=!1,idGenerator:R=co}=t,E=a??ze,[D]=(0,e.useState)(t.query??t.defaultQuery),O=(({finalize:t,...r})=>{const o=(0,e.useContext)(Ue),n=wo(!1,r.debugMode,o.debugMode),a=t?n:r.debugMode??o.debugMode,l=wo(!0,r.enableMountQueryChange,o.enableMountQueryChange),s=t?l:r.enableMountQueryChange??o.enableMountQueryChange,i=wo(!1,r.enableDragAndDrop,o.enableDragAndDrop)&&!1!==o.enableDragAndDrop,u=t?i:r.enableDragAndDrop??o.enableDragAndDrop,c=(0,e.useMemo)((()=>ko(t?Object.assign({},at):Go,o.controlClassnames,r.controlClassnames)),[o.controlClassnames,r.controlClassnames,t]),d=(0,e.useMemo)((()=>({actionElement:c.actionElement,addGroup:c.addGroup,addRule:c.addRule,body:c.body,cloneGroup:c.cloneGroup,cloneRule:c.cloneRule,combinators:c.combinators,dragHandle:c.dragHandle,fields:c.fields,header:c.header,lockGroup:c.lockGroup,lockRule:c.lockRule,notToggle:c.notToggle,operators:c.operators,queryBuilder:c.queryBuilder,removeGroup:c.removeGroup,removeRule:c.removeRule,rule:c.rule,ruleGroup:c.ruleGroup,shiftActions:c.shiftActions,value:c.value,valueSelector:c.valueSelector,valueSource:c.valueSource,betweenRules:c.betweenRules,valid:c.valid,invalid:c.invalid,dndDragging:c.dndDragging,dndOver:c.dndOver,dndCopy:c.dndCopy,disabled:c.disabled,valueListItem:c.valueListItem,branches:c.branches})),[c.actionElement,c.addGroup,c.addRule,c.betweenRules,c.body,c.branches,c.cloneGroup,c.cloneRule,c.combinators,c.disabled,c.dndCopy,c.dndDragging,c.dndOver,c.dragHandle,c.fields,c.header,c.invalid,c.lockGroup,c.lockRule,c.notToggle,c.operators,c.queryBuilder,c.removeGroup,c.removeRule,c.rule,c.ruleGroup,c.shiftActions,c.valid,c.value,c.valueListItem,c.valueSelector,c.valueSource]),p=o.controlElements??Go,f=r.controlElements??Go,m=(0,e.useCallback)(((e,r,o)=>{const n="dragHandle"===e?So:No,a=(e.endsWith("Action")&&f.actionElement?f.actionElement:void 0)??(e.endsWith("Selector")&&f.valueSelector?f.valueSelector:void 0),l=(e.endsWith("Action")&&p.actionElement?p.actionElement:void 0)??(e.endsWith("Selector")&&p.valueSelector?p.valueSelector:void 0),s=null===r?n:r??(t?a:void 0)??(null===o?n:o??(t?l:void 0));return s?{[e]:s}:t?{[e]:$o[e]}:Go}),[p.actionElement,p.valueSelector,t,f.actionElement,f.valueSelector]),h=(0,e.useMemo)((()=>Object.assign({},m("addGroupAction",f.addGroupAction,p.addGroupAction),m("addRuleAction",f.addRuleAction,p.addRuleAction),m("cloneGroupAction",f.cloneGroupAction,p.cloneGroupAction),m("cloneRuleAction",f.cloneRuleAction,p.cloneRuleAction),m("combinatorSelector",f.combinatorSelector,p.combinatorSelector),m("dragHandle",f.dragHandle,p.dragHandle),m("fieldSelector",f.fieldSelector,p.fieldSelector),m("inlineCombinator",f.inlineCombinator,p.inlineCombinator),m("lockGroupAction",f.lockGroupAction,p.lockGroupAction),m("lockRuleAction",f.lockRuleAction,p.lockRuleAction),m("notToggle",f.notToggle,p.notToggle),m("operatorSelector",f.operatorSelector,p.operatorSelector),m("removeGroupAction",f.removeGroupAction,p.removeGroupAction),m("removeRuleAction",f.removeRuleAction,p.removeRuleAction),m("shiftActions",f.shiftActions,p.shiftActions),{valueEditor:null===f.valueEditor?No:f.valueEditor??(null===p.valueEditor?No:p.valueEditor)??$o.valueEditor},m("valueSourceSelector",f.valueSourceSelector,p.valueSourceSelector),m("rule",f.rule,p.rule),m("ruleGroup",f.ruleGroup,p.ruleGroup),m("ruleGroupBodyElements",f.ruleGroupBodyElements,p.ruleGroupBodyElements),m("ruleGroupHeaderElements",f.ruleGroupHeaderElements,p.ruleGroupHeaderElements),{actionElement:f.actionElement??p.actionElement??(t?$o.actionElement:void 0)},{valueSelector:f.valueSelector??p.valueSelector??(t?$o.valueSelector:void 0)})),[p.actionElement,p.addGroupAction,p.addRuleAction,p.cloneGroupAction,p.cloneRuleAction,p.combinatorSelector,p.dragHandle,p.fieldSelector,p.inlineCombinator,p.lockGroupAction,p.lockRuleAction,p.notToggle,p.operatorSelector,p.removeGroupAction,p.removeRuleAction,p.rule,p.ruleGroup,p.ruleGroupBodyElements,p.ruleGroupHeaderElements,p.shiftActions,p.valueEditor,p.valueSelector,p.valueSourceSelector,m,t,f.actionElement,f.addGroupAction,f.addRuleAction,f.cloneGroupAction,f.cloneRuleAction,f.combinatorSelector,f.dragHandle,f.fieldSelector,f.inlineCombinator,f.lockGroupAction,f.lockRuleAction,f.notToggle,f.operatorSelector,f.removeGroupAction,f.removeRuleAction,f.rule,f.ruleGroup,f.ruleGroupBodyElements,f.ruleGroupHeaderElements,f.shiftActions,f.valueEditor,f.valueSelector,f.valueSourceSelector]),b=r.translations??Go,g=o.translations??Go;return{controlClassnames:d,controlElements:h,debugMode:a,enableDragAndDrop:u,enableMountQueryChange:s,translations:(0,e.useMemo)((()=>Object.assign(t?Object.assign({},He):{},xo("addGroup",{label:[b.addGroup?.label,g.addGroup?.label],title:[b.addGroup?.title,g.addGroup?.title]},t),xo("addRule",{label:[b.addRule?.label,g.addRule?.label],title:[b.addRule?.title,g.addRule?.title]},t),xo("cloneRule",{label:[b.cloneRule?.label,g.cloneRule?.label],title:[b.cloneRule?.title,g.cloneRule?.title]},t),xo("cloneRuleGroup",{label:[b.cloneRuleGroup?.label,g.cloneRuleGroup?.label],title:[b.cloneRuleGroup?.title,g.cloneRuleGroup?.title]},t),xo("combinators",{title:[b.combinators?.title,g.combinators?.title]},t),xo("dragHandle",{label:[b.dragHandle?.label,g.dragHandle?.label],title:[b.dragHandle?.title,g.dragHandle?.title]},t),xo("fields",{placeholderGroupLabel:[b.fields?.placeholderGroupLabel,g.fields?.placeholderGroupLabel],placeholderLabel:[b.fields?.placeholderLabel,g.fields?.placeholderLabel],placeholderName:[b.fields?.placeholderName,g.fields?.placeholderName],title:[b.fields?.title,g.fields?.title]},t),xo("lockGroup",{label:[b.lockGroup?.label,g.lockGroup?.label],title:[b.lockGroup?.title,g.lockGroup?.title]},t),xo("lockGroupDisabled",{label:[b.lockGroupDisabled?.label,g.lockGroupDisabled?.label],title:[b.lockGroupDisabled?.title,g.lockGroupDisabled?.title]},t),xo("lockRule",{label:[b.lockRule?.label,g.lockRule?.label],title:[b.lockRule?.title,g.lockRule?.title]},t),xo("lockRuleDisabled",{label:[b.lockRuleDisabled?.label,g.lockRuleDisabled?.label],title:[b.lockRuleDisabled?.title,g.lockRuleDisabled?.title]},t),xo("notToggle",{label:[b.notToggle?.label,g.notToggle?.label],title:[b.notToggle?.title,g.notToggle?.title]},t),xo("operators",{placeholderGroupLabel:[b.operators?.placeholderGroupLabel,g.operators?.placeholderGroupLabel],placeholderLabel:[b.operators?.placeholderLabel,g.operators?.placeholderLabel],placeholderName:[b.operators?.placeholderName,g.operators?.placeholderName],title:[b.operators?.title,g.operators?.title]},t),xo("removeGroup",{label:[b.removeGroup?.label,g.removeGroup?.label],title:[b.removeGroup?.title,g.removeGroup?.title]},t),xo("removeRule",{label:[b.removeRule?.label,g.removeRule?.label],title:[b.removeRule?.title,g.removeRule?.title]},t),xo("shiftActionDown",{label:[b.shiftActionDown?.label,g.shiftActionDown?.label],title:[b.shiftActionDown?.title,g.shiftActionDown?.title]},t),xo("shiftActionUp",{label:[b.shiftActionUp?.label,g.shiftActionUp?.label],title:[b.shiftActionUp?.title,g.shiftActionUp?.title]},t),xo("value",{title:[b.value?.title,g.value?.title]},t),xo("valueSourceSelector",{title:[b.valueSourceSelector?.title,g.valueSourceSelector?.title]},t))),[b.addGroup?.label,b.addGroup?.title,b.addRule?.label,b.addRule?.title,b.cloneRule?.label,b.cloneRule?.title,b.cloneRuleGroup?.label,b.cloneRuleGroup?.title,b.combinators?.title,b.dragHandle?.label,b.dragHandle?.title,b.fields?.placeholderGroupLabel,b.fields?.placeholderLabel,b.fields?.placeholderName,b.fields?.title,b.lockGroup?.label,b.lockGroup?.title,b.lockGroupDisabled?.label,b.lockGroupDisabled?.title,b.lockRule?.label,b.lockRule?.title,b.lockRuleDisabled?.label,b.lockRuleDisabled?.title,b.notToggle?.label,b.notToggle?.title,b.operators?.placeholderGroupLabel,b.operators?.placeholderLabel,b.operators?.placeholderName,b.operators?.title,b.removeGroup?.label,b.removeGroup?.title,b.removeRule?.label,b.removeRule?.title,b.shiftActionDown?.label,b.shiftActionDown?.title,b.shiftActionUp?.label,b.shiftActionUp?.title,b.value?.title,b.valueSourceSelector?.title,t,g.addGroup?.label,g.addGroup?.title,g.addRule?.label,g.addRule?.title,g.cloneRule?.label,g.cloneRule?.title,g.cloneRuleGroup?.label,g.cloneRuleGroup?.title,g.combinators?.title,g.dragHandle?.label,g.dragHandle?.title,g.fields?.placeholderGroupLabel,g.fields?.placeholderLabel,g.fields?.placeholderName,g.fields?.title,g.lockGroup?.label,g.lockGroup?.title,g.lockGroupDisabled?.label,g.lockGroupDisabled?.title,g.lockRule?.label,g.lockRule?.title,g.lockRuleDisabled?.label,g.lockRuleDisabled?.title,g.notToggle?.label,g.notToggle?.title,g.operators?.placeholderGroupLabel,g.operators?.placeholderLabel,g.operators?.placeholderName,g.operators?.title,g.removeGroup?.label,g.removeGroup?.title,g.removeRule?.label,g.removeRule?.title,g.shiftActionDown?.label,g.shiftActionDown?.title,g.shiftActionUp?.label,g.shiftActionUp?.title,g.value?.title,g.valueSourceSelector?.title]),initialQuery:r.initialQuery,qbId:r.qbId}})({controlClassnames:d,controlElements:p,debugMode:G,enableDragAndDrop:N,enableMountQueryChange:c,translations:u,initialQuery:D,qbId:r,finalize:!0}),{translations:k}=O,I=(0,e.useMemo)((()=>({id:k.fields.placeholderName,name:k.fields.placeholderName,value:k.fields.placeholderName,label:k.fields.placeholderLabel})),[k.fields.placeholderLabel,k.fields.placeholderName]),_=(0,e.useMemo)((()=>o??[I]),[I,o]),x=(0,e.useMemo)((()=>{const e=Array.isArray(_)?ar(_,n):Io(lr(_,n)).map((e=>({..._[e],name:e,value:e}))).sort(((e,t)=>e.label.localeCompare(t.label)));return ur(e)?pr(C?e:[{label:k.fields.placeholderGroupLabel,options:[I]},...e]):sr(C?e:[I,...e])}),[C,n,I,_,k.fields.placeholderGroupLabel]),q=(0,e.useMemo)((()=>{if(!Array.isArray(_)){const e=lr(_,n);return C?e:{...e,[k.fields.placeholderName]:I}}const e={};if(ur(x))for(const t of x)for(const r of t.options)e[r.value??r.name]=nr(r,n);else for(const t of x)e[t.value??t.name]=nr(t,n);return e}),[C,n,I,x,_,k.fields.placeholderName]),M=(0,e.useMemo)((()=>ar(s,i)),[i,s]),B=(0,e.useMemo)((()=>({id:k.operators.placeholderName,name:k.operators.placeholderName,value:k.operators.placeholderName,label:k.operators.placeholderLabel})),[k.operators.placeholderLabel,k.operators.placeholderName]),j=(0,e.useCallback)(((e,{fieldData:t})=>{let r=ar(E,l);if(t?.operators)r=ar(t.operators,l);else if(b){const o=b(e,{fieldData:t});o&&(r=ar(o,l))}return $||(r=ur(r)?[{label:k.operators.placeholderGroupLabel,options:[B]},...r]:[B,...r]),ur(o=r)?pr(o):sr(o.map((e=>nr(e))));var o}),[$,l,B,b,E,k.operators.placeholderGroupLabel]),T=(0,e.useCallback)((e=>{const t=q[e];if(t?.defaultOperator)return t.defaultOperator;if(m)return"function"==typeof m?m(e,{fieldData:t}):m;const r=j(e,{fieldData:t})??[];return dr(r)??""}),[q,m,j]),P=(0,e.useCallback)(((e,t,{fieldData:r})=>r.valueEditorType?"function"==typeof r.valueEditorType?r.valueEditorType(t):r.valueEditorType:g?.(e,t,{fieldData:r})??"text"),[g]),W=(0,e.useCallback)(((e,t)=>((e,t,r)=>{const o=e?nr(e):Do;if(o.valueSources)return"function"==typeof o.valueSources?o.valueSources(t):o.valueSources;if(r){const e=r(o.value,t,{fieldData:nr(o)});if(e)return e}return Eo})(q[e],t,v)),[q,v]),L=(0,e.useCallback)(((e,t,{fieldData:r})=>r?.values?ar(r.values):A?ar(A(e,t,{fieldData:r})):[]),[A]),U=(0,e.useCallback)((e=>{const t=q[e.field]??{};if(void 0!==t?.defaultValue&&null!==t.defaultValue)return t.defaultValue;if(h)return h(e,{fieldData:t});let r="";const o=L(e.field,e.operator,{fieldData:t});if("field"===e.valueSource){const o=mr(t,x,e.operator);r=o.length>0?Ko(o,e,S):""}else if(o.length>0){const n=P(e.field,e.operator,{fieldData:t});"multiselect"===n?r=S?[]:"":"select"!==n&&"radio"!==n||(r=Ko(o,e,S))}else"checkbox"===P(e.field,e.operator,{fieldData:t})&&(r=!1);return r}),[q,x,h,P,L,S]),F=(0,e.useCallback)(((e,t,{fieldData:r})=>{if(y){const o=y(e,t,{fieldData:r});if(o)return o}return"text"}),[y]),V=(0,e.useCallback)((()=>{let e="";const t=x;if(t?.length>0&&t[0]){const r=dr(t);r&&(e=r)}if(f)if("function"==typeof f){const r=f(t);r&&(e=r)}else e=f;const r=T(e),o=W(e,r)[0]??"value",n={id:R(),field:e,operator:r,valueSource:o,value:""},a=U(n);return{...n,value:a}}),[x,f,T,U,W,R]),Q=(0,e.useCallback)((e=>e?{id:R(),rules:w?[V()]:[],not:!1}:{id:R(),rules:w?[V()]:[],combinator:dr(M)??"",not:!1}),[w,M,V,R]);return{qbId:r,rqbContext:O,fields:x,fieldMap:q,combinators:M,getOperatorsMain:j,getRuleDefaultOperator:T,getValueEditorTypeMain:P,getValueSourcesMain:W,getValuesMain:L,getRuleDefaultValue:U,getInputTypeMain:F,createRule:V,createRuleGroup:Q}},Yo=[],Zo=t=>e.createElement(f,{context:Mt,store:qt},t.children),en=({props:t})=>{const r=rn(t),o=r.schema.controls.ruleGroup,n=Ue;return e.createElement(n.Provider,{key:r.dndEnabledAttr,value:r.rqbContext},e.createElement("div",{role:"form",className:r.wrapperClassName,"data-dnd":r.dndEnabledAttr,"data-inlinecombinators":r.inlineCombinatorsAttr},e.createElement(o,{translations:r.translations,ruleGroup:r.rootGroup,rules:r.rootGroup.rules,...r.combinatorPropObject,not:!!r.rootGroup.not,schema:r.schema,actions:r.actions,id:r.rootGroup.id,path:Yo,disabled:r.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:r.queryDisabled,context:t.context})))},tn=t=>e.createElement(Zo,null,e.createElement(en,{props:t})),rn=e=>Xo(e,Jo(e)),on=r(72),nn=r.n(on),an=r(825),ln=r.n(an),sn=r(659),un=r.n(sn),cn=r(56),dn=r.n(cn),pn=r(540),fn=r.n(pn),mn=r(113),hn=r.n(mn),bn=r(992),gn={};function vn(){return vn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)({}).hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},vn.apply(null,arguments)}function yn(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return"";const r=e=>t?function(e){return"string"!=typeof e?String(e):e.replace(/\\/g,"\\5c").replace(/\*/g,"\\2a").replace(/\(/g,"\\28").replace(/\)/g,"\\29").replace(/\0/g,"\\00")}(e):e,o=(e,t)=>t?`(!${e})`:`${e}`;if(e.rules){if(0===e.rules.length)return"";const r="and"===e.combinator?"&":"|",o=e.not?"(!":"",n=e.not?")":"";return`(${r}${o}${e.rules.map((e=>yn(e,t))).join("")}${n})`}const{field:n,operator:a,value:l}=e,s=a.toLowerCase();let i="";switch(s){case"=":case"!=":return o(`(${n}=${r(l)})`,s.includes("!"));case">":case">=":return o(`(${n}>=${r(l)})`,s.includes("!"));case"<":case"<=":return o(`(${n}<=${r(l)})`,s.includes("!"));case"~=":case"!~=":return o(`(${n}~=${r(l)})`,s.includes("!"));case"contains":case"doesnotcontain":case"like":case"notlike":return o(`(${n}=*${r(l)}*)`,s.includes("not"));case"in":case"notin":return i=`(|${l.split(",").map((e=>`(${n}=${r(e)})`)).join("")})`,o(i,s.includes("not"));case"beginswith":case"doesnotbeginwith":return o(`(${n}=${r(l)}*)`,s.includes("not"));case"endswith":case"doesnotendwith":return o(`(${n}=*${r(l)})`,s.includes("not"));case"null":return`(!(${n}=*))`;case"notnull":return`(${n}=*)`;case"between":case"notbetween":return i=`(&(${n}>=${r(l.split(",")[0])})(${n}<=${r(l.split(",")[1])}))`,o(i,s.includes("not"));case"memberof":case"notmemberof":return o(`(${n}=${r(l)})`,s.includes("not"));case"matchingruleinchain":case"memberofrecursive":case"notmatchingruleinchain":case"notmemberofrecursive":return i=`(${n}:1.2.840.113556.1.4.1941:=${r(l)})`,o(i,s.includes("not"));case"extensiblematch":case"notextensiblematch":return o(`(${n}:dn:=${r(l)})`,s.includes("not"));case"bitwiseand":case"notbitwiseand":return i=`(${n}:1.2.840.113556.1.4.803:=${r(l)})`,o(i,s.includes("not"));case"bitwiseor":case"notbitwiseor":return i=`(${n}:1.2.840.113556.1.4.804:=${r(l)})`,o(i,s.includes("not"));default:return`(${n} ?? Unsupported: ${a} ?? ${r(l)})`}}gn.styleTagTransform=hn(),gn.setAttributes=dn(),gn.insert=un().bind(null,"head"),gn.domAPI=ln(),gn.insertStyleElement=fn(),nn()(bn.A,gn),bn.A&&bn.A.locals&&bn.A.locals;const An=["json","sql","json_without_ids","parameterized","parameterized_named","mongodb","mongodb_query","cel","jsonlogic","spel","elasticsearch","jsonata","natural_language","ldap","ldap_escaped"],Cn=["default","enhanced","enhanced-limited","native","native-limited","strict","strict-limited"],$n={combinator:"and",rules:[]},wn=(0,o.withComponentFeatures)((r=>{const[o,n]=(0,e.useState)(r.query?r.query:$n),[a,l]=(0,e.useState)(r.formats?r.formats:An),[s,i]=(0,e.useState)(r.parseNumbers?r.parseNumbers:Cn),[u,c]=(0,e.useState)({}),[d,p]=(0,e.useState)([]);return(0,e.useEffect)((()=>{r.setState({value:o,formattedArray:d,formated:u})}),[o]),t().createElement(tn,vn({id:r.id,query:o,onQueryChange:e=>{n(e),(e=>{const t=a.map((t=>({FormatType:t,Result:"ldap"===t?yn(e,!1):"ldap_escaped"===t?yn(e,!0):to(e,t)}))),o=a.reduce(((t,r)=>(t[`${r}`]="ldap"===r?yn(e,!1):"ldap_escaped"===r?yn(e,!0):to(e,r),t)),{});r.onChange&&r.onChange({value:e,formattedArray:t,formatted:o})})(e),(e=>{const t=a.reduce(((t,r)=>(t[`data-${r}`]="ldap"===r?yn(e,!0):to(e,r),t)),{});c(t)})(e),(e=>{const t=a.map((t=>({FormatType:t,Result:"ldap"===t?yn(e,!1):"ldap_escaped"===t?yn(e,!0):to(e,t)})));p(t)})(e)},fields:r.fields},r.queryBuilder))}));UniversalDashboard.register("ud-reactquerybuilder",wn)})(),udcomponent={}})();
//# sourceMappingURL=index.5dbeff509477d22031ac.bundle.map